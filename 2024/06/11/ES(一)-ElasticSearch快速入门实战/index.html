<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>萝卜的博客 | 萝卜的博客</title><meta name="author" content="Radish"><meta name="copyright" content="Radish"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一、全文检索1、什么是全文检索全文检索是一种通过对文本内容进行全面索引和搜索的技术。它可以快速地在大量文本数据中查找包含特定关键词或短语的文档，并返回相关的搜索结果。全文检索广泛应用于各种信息管理系统和应用中，如搜索引擎、文档管理系统、电子邮件客户端、新闻聚合网站等。它可以帮助用户快速定位所需信息，提高检索效率和准确性。  查询：有明确的搜索条件边界。比如，年龄 15~25 岁，颜色 =">
<meta property="og:type" content="article">
<meta property="og:title" content="萝卜的博客">
<meta property="og:url" content="http://example.com/2024/06/11/ES(%E4%B8%80)-ElasticSearch%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%AE%9E%E6%88%98/index.html">
<meta property="og:site_name" content="萝卜的博客">
<meta property="og:description" content="一、全文检索1、什么是全文检索全文检索是一种通过对文本内容进行全面索引和搜索的技术。它可以快速地在大量文本数据中查找包含特定关键词或短语的文档，并返回相关的搜索结果。全文检索广泛应用于各种信息管理系统和应用中，如搜索引擎、文档管理系统、电子邮件客户端、新闻聚合网站等。它可以帮助用户快速定位所需信息，提高检索效率和准确性。  查询：有明确的搜索条件边界。比如，年龄 15~25 岁，颜色 =">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/git.png">
<meta property="article:published_time" content="2024-06-11T15:06:00.000Z">
<meta property="article:modified_time" content="2024-06-16T08:53:22.862Z">
<meta property="article:author" content="Radish">
<meta property="article:tag" content="ElasticSearch">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/git.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2024/06/11/ES(%E4%B8%80)-ElasticSearch%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%AE%9E%E6%88%98/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '萝卜的博客',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-06-16 16:53:22'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/modify.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/touxiang.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">72</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">19</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/message/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/%E9%9F%B3%E4%B9%90"><i class="fa-fw /music/"></i><span> 0</span></a></li><li><a class="site-page child" href="/%E8%A7%86%E9%A2%91"><i class="fa-fw /movies/"></i><span> 1</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="萝卜的博客"><span class="site-name">萝卜的博客</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/message/"><i class="fa-fw fa fa-coffee"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/%E9%9F%B3%E4%B9%90"><i class="fa-fw /music/"></i><span> 0</span></a></li><li><a class="site-page child" href="/%E8%A7%86%E9%A2%91"><i class="fa-fw /movies/"></i><span> 1</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">无题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-06-11T15:06:00.000Z" title="发表于 2024-06-11 23:06:00">2024-06-11</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-06-16T08:53:22.862Z" title="更新于 2024-06-16 16:53:22">2024-06-16</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java%E5%90%8E%E7%AB%AF/">Java后端</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java%E5%90%8E%E7%AB%AF/%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84/">分布式架构</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java%E5%90%8E%E7%AB%AF/%E5%88%86%E5%B8%83%E5%BC%8F%E6%9E%B6%E6%9E%84/ElasticSearch/">ElasticSearch</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><h1 id="一、全文检索"><a href="#一、全文检索" class="headerlink" title="一、全文检索"></a>一、全文检索</h1><h2 id="1、什么是全文检索"><a href="#1、什么是全文检索" class="headerlink" title="1、什么是全文检索"></a>1、什么是全文检索</h2><p><font color="red">全文检索是一种通过对文本内容进行全面索引和搜索的技术。</font>它可以快速地在大量文本数据中查找包含特定关键词或短语的文档，并返回相关的搜索结果。全文检索广泛应用于各种信息管理系统和应用中，如搜索引擎、文档管理系统、电子邮件客户端、新闻聚合网站等。它可以帮助用户快速定位所需信息，提高检索效率和准确性。</p>
<blockquote>
<p><strong>查询</strong>：有明确的搜索条件边界。比如，年龄 15~25 岁，颜色 = 红色，价格 &lt; 3000，这里的 15、25、红色、3000 都是条件边界。即有明确的范围界定。</p>
<p><strong>检索</strong>：即全文检索，无搜索条件边界，召回结果取决于相关性，其相关性计算无明确边界性条件，如同义词、谐音、别名、错别字、混淆词、网络热梗等均可成为其相关性判断依据。</p>
</blockquote>
<p>设想一个关于全文检索的场景，比如搜索Java设计模式：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>标题</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Java中的23种设计模式</td>
<td>Java中23种设计模式，包括简单介绍,适用场景以及优缺点等</td>
</tr>
<tr>
<td>2</td>
<td>Java多线程设计模式</td>
<td>Java多线程与设计模式结合</td>
</tr>
<tr>
<td>3</td>
<td>设计模式之美</td>
<td>结合真实项目案例，从面向对象编程范式、设计原则、代码规范、重构技巧和设计模式5个方面详细介绍如何编写高质量代码。</td>
</tr>
<tr>
<td>4</td>
<td>JavaScript设计模式与开发实践</td>
<td>针对JavaScript语言特性全面介绍了更适合JavaScript程序员的了16个常用的设计模式</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr>
<td>10亿</td>
<td>Java并发编程实战</td>
<td>深入浅出地介绍了Java线程和并发，是一本完美的Java并发参考手册</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody></table>
<p><font color="red">思考：用传统关系型数据库实现有什么问题？</font></p>
<p>如果是用MySQL存储文章 ，我们应该会使用这样的 SQL 去查询</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t_blog <span class="keyword">where</span> content <span class="keyword">like</span> "%Java设计模式%"</span><br></pre></td></tr></tbody></table></figure>

<p>这种需要遍历所有的记录进行匹配，不但效率低，而且搜索结果不符合我们搜索时的期望。</p>
<h2 id="2、全文检索的原理"><a href="#2、全文检索的原理" class="headerlink" title="2、全文检索的原理"></a>2、全文检索的原理</h2><p>在全文检索中，<font color="red">首先需要对文本数据进行处理，包括分词、去除停用词等。</font>然后，<font color="red">对处理后的文本数据建立索引，索引会记录每个单词在文档中的位置信息以及其他相关的元数据，如词频、权重等。这个过程通常使用倒排索引（inverted index）来实现</font>，倒排索引将单词映射到包含该单词的文档列表中，以便快速定位相关文档。</p>
<p><font color="red">当用户发起搜索请求时，搜索引擎会根据用户提供的关键词或短语，在建立好的索引中查找匹配的文档。</font>搜索引擎会根据索引中的信息计算文档的相关性，并按照相关性排序返回搜索结果。用户可以通过不同的搜索策略和过滤条件来精确控制搜索结果的质量和范围。</p>
<h2 id="3、什么是倒排索引"><a href="#3、什么是倒排索引" class="headerlink" title="3、什么是倒排索引"></a>3、什么是倒排索引</h2><p>正排索引（Forward Index）和倒排索引（Inverted Index）是全文检索中常用的两种索引结构，它们在索引和搜索的过程中扮演不同的角色。</p>
<p><strong>正排索引（正向索引）</strong></p>
<p><font color="red">正排索引是将文档按顺序排列并进行编号的索引结构。</font>每个文档都包含了完整的文本内容，以及其他相关的属性或元数据，如标题、作者、发布日期等。<font color="red">在正排索引中，可以根据文档编号或其他属性快速定位和访问文档的内容。</font>正排索引适合用于需要对文档进行整体检索和展示的场景，但对于包含大量文本内容的数据集来说，正排索引的存储和查询效率可能会受到限制。</p>
<p>在MySQL 中通过 ID 查找就是一种正排索引的应用。</p>
<p><strong>倒排索引（反向索引）</strong></p>
<p><font color="red">倒排索引是根据单词或短语建立的索引结构。</font>它将每个单词映射到包含该单词的文档列表中。<font color="red">倒排索引的建立过程是先对文档进行分词处理，然后记录每个单词在哪些文档中出现，以及出现的位置信息。</font>通过倒排索引，可以根据关键词或短语快速找到包含这些词语的文档，并确定它们的相关性。<font color="red">倒排索引适用于在大规模文本数据中进行关键词搜索和相关性排序的场景，它能够快速定位文档，提高搜索效率。</font></p>
<p>我们在创建文章的时候，建立一个关键词与文章的对应关系表，就可以称之为倒排索引。如下图所示：</p>
<table>
<thead>
<tr>
<th>关键词</th>
<th>文章ID</th>
<th>是否命中索引</th>
</tr>
</thead>
<tbody><tr>
<td>Java</td>
<td>1,2</td>
<td>√</td>
</tr>
<tr>
<td>设计模式</td>
<td>1,2,3,4</td>
<td>√</td>
</tr>
<tr>
<td>多线程</td>
<td>2</td>
<td></td>
</tr>
<tr>
<td>JavaScript</td>
<td>4</td>
<td></td>
</tr>
</tbody></table>
<h1 id="二、ElasticSearch简介"><a href="#二、ElasticSearch简介" class="headerlink" title="二、ElasticSearch简介"></a>二、ElasticSearch简介</h1><h2 id="1、ElasticSearch介绍"><a href="#1、ElasticSearch介绍" class="headerlink" title="1、ElasticSearch介绍"></a>1、<strong>ElasticSearch介绍</strong></h2><p>ElasticSearch（简称ES）是一个<font color="red">开源的分布式搜索和数据分析引擎</font>，是用Java开发并且是当前最流行的开源的企业级搜索引擎，能够达到近实时搜索，<font color="red">它专门设计用于处理大规模的文本数据和实现高性能的全文检索。</font></p>
<p>以下是一些 Elasticsearch 的特点和优势：</p>
<ul>
<li>分布式架构：Elasticsearch 是一个分布式系统，可以轻松地水平扩展，处理大规模的数据集和高并发的查询请求。</li>
<li>全文检索功能：Elasticsearch 提供了强大的全文检索功能，包括分词、词项查询、模糊匹配、多字段搜索等，并支持丰富的查询语法和过滤器。</li>
<li>多语言支持：Elasticsearch 支持多种语言的分词器和语言处理器，可以很好地处理不同语言的文本数据。</li>
<li>高性能：Elasticsearch 使用倒排索引和缓存等技术，具有快速的搜索速度和高效的查询性能。</li>
<li>实时性：Elasticsearch 支持实时索引和搜索，可以几乎实时地将文档添加到索引中，并立即可见。</li>
<li>易用性：Elasticsearch 提供了简单易用的 RESTful API，方便进行索引管理、查询操作和数据分析。</li>
</ul>
<p><strong>官方网站:</strong> <a target="_blank" rel="noopener" href="https://www.elastic.co/">https://www.elastic.co/</a></p>
<p><strong>下载地址：</strong><a target="_blank" rel="noopener" href="https://www.elastic.co/cn/downloads/past-releases#elasticsearch">https://www.elastic.co/cn/downloads/past-releases#elasticsearch</a></p>
<p>搜索引擎排名：</p>
<p><img src="/../img/1718119496699.png" alt="1718119496699"></p>
<blockquote>
<p> 参考网站：<a target="_blank" rel="noopener" href="https://db-engines.com/en/ranking/search+engine">https://db-engines.com/en/ranking/search+engine</a></p>
</blockquote>
<h2 id="2、ElasticSearch"><a href="#2、ElasticSearch" class="headerlink" title="2、ElasticSearch"></a>2、ElasticSearch</h2><p><font color="red">只要用到搜索的场景，ES几乎都可以是最好的选择。</font>国内现在有大量的公司都在使用 Elasticsearch，包括携程、滴滴、今日头条、饿了么、360安全、小米、vivo等诸多知名公司。除了搜索之外，结合Kibana、Logstash、Beats，Elastic Stack还被广泛运用在大数据近实时分析领域，包括日志分析、指标监控、信息安全等多个领域。它可以帮助你探索海量结构化、非结构化数据，按需创建可视化报表，对监控数据设置报警阈值，甚至通过使用机器学习技术，自动识别异常状况。</p>
<ul>
<li>搜索引擎</li>
<li>站内搜索</li>
<li>日志管理与分析</li>
<li>大数据分析</li>
</ul>
<h2 id="3、技术选型"><a href="#3、技术选型" class="headerlink" title="3、技术选型"></a>3、技术选型</h2><table>
<thead>
<tr>
<th></th>
<th>Elasticsearch</th>
<th>Solr</th>
<th>MongoDB</th>
<th>MySQL</th>
</tr>
</thead>
<tbody><tr>
<td>DB类型</td>
<td>搜索引擎</td>
<td>搜索引擎</td>
<td>文档数据库</td>
<td>关系型数据库</td>
</tr>
<tr>
<td>基于何种框架开发</td>
<td>Lucene</td>
<td>Lucene</td>
<td></td>
<td></td>
</tr>
<tr>
<td>基于何种开发语言</td>
<td>Java</td>
<td>Java</td>
<td>C++</td>
<td>C、C++</td>
</tr>
<tr>
<td>数据结构</td>
<td>FST、Hash等</td>
<td></td>
<td></td>
<td>B+ Trees</td>
</tr>
<tr>
<td>数据格式</td>
<td>Json</td>
<td>Json/XML/CSV</td>
<td>Json</td>
<td>Row</td>
</tr>
<tr>
<td>分布式支持</td>
<td>原生支持</td>
<td>支持</td>
<td>原生支持</td>
<td>不支持</td>
</tr>
<tr>
<td>数据分区方案</td>
<td>分片</td>
<td>分片</td>
<td>分片</td>
<td>分库分表</td>
</tr>
<tr>
<td>业务系统类型</td>
<td>OLAP</td>
<td>OLAP</td>
<td>OLTP</td>
<td>OLTP</td>
</tr>
<tr>
<td>事务支持</td>
<td>不支持</td>
<td>不支持</td>
<td>多文档ACID事务</td>
<td>支持</td>
</tr>
<tr>
<td>数据量级</td>
<td>PB级</td>
<td>TB级~PB级</td>
<td>PB级</td>
<td>单库3000万</td>
</tr>
<tr>
<td>一致性策略</td>
<td>最终一致性</td>
<td>最终一致性</td>
<td>最终一致性即时一致性</td>
<td>即时一致性</td>
</tr>
<tr>
<td>擅长领域</td>
<td>海量数据全文检索大数据聚合分析</td>
<td>大数据全文检索</td>
<td>海量数据CRUD</td>
<td>强一致性ACID事务</td>
</tr>
<tr>
<td>劣势</td>
<td>不支持事务写入实时性低</td>
<td>海量数据的性能不如ES随着数据量的不断增大，稳定性低于ES</td>
<td>弱事务支持不支持join查询</td>
<td>大数据全文搜索性能低</td>
</tr>
<tr>
<td>查询性能</td>
<td>★★★★★</td>
<td>★★★★</td>
<td>★★★★★</td>
<td>★★★</td>
</tr>
<tr>
<td>写入性能</td>
<td>★★</td>
<td>★★</td>
<td>★★★★</td>
<td>★★★</td>
</tr>
</tbody></table>
<h1 id="三、ElasticSearch环境搭建"><a href="#三、ElasticSearch环境搭建" class="headerlink" title="三、ElasticSearch环境搭建"></a>三、ElasticSearch环境搭建</h1><h2 id="1、安装ElasticSearch环境搭建"><a href="#1、安装ElasticSearch环境搭建" class="headerlink" title="1、安装ElasticSearch环境搭建"></a>1、安装ElasticSearch环境搭建</h2><p>安装文档：<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/targz.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.17/targz.html</a></p>
<p><font color="red">温馨提示：初学者建议直接安装windows版本的ElasticSearch，安装包解压后就可以直接运行</font></p>
<h3 id="windows安装ElasticSearch"><a href="#windows安装ElasticSearch" class="headerlink" title="windows安装ElasticSearch"></a><strong>windows安装ElasticSearch</strong></h3><p><strong>1）下载ElasticSearch</strong></p>
<p>下载地址： <a target="_blank" rel="noopener" href="https://www.elastic.co/cn/downloads/past-releases#elasticsearch">https://www.elastic.co/cn/downloads/past-releases#elasticsearch</a></p>
<p>选择版本：7.17.3</p>
<p><img src="/../img/1718119795146.png" alt="1718119795146"></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># windows</span><br><span class="line">https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.17.3-windows-x86_64.zip</span><br></pre></td></tr></tbody></table></figure>

<p><strong>ElasticSearch文件目录结构</strong></p>
<table>
<thead>
<tr>
<th>目录</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>bin</td>
<td>脚本文件，包括启动elasticsearch，安装插件，运行统计数据等</td>
</tr>
<tr>
<td>config</td>
<td>配置文件目录，如elasticsearch配置、角色配置、jvm配置等。</td>
</tr>
<tr>
<td>jdk</td>
<td>7.x 以后特有，自带的 java 环境，8.x版本自带 jdk 17</td>
</tr>
<tr>
<td>data</td>
<td>默认的数据存放目录，包含节点、分片、索引、文档的所有数据，生产环境需要修改。</td>
</tr>
<tr>
<td>lib</td>
<td>elasticsearch依赖的Java类库</td>
</tr>
<tr>
<td>logs</td>
<td>默认的日志文件存储路径，生产环境需要修改。</td>
</tr>
<tr>
<td>modules</td>
<td>包含所有的Elasticsearch模块，如Cluster、Discovery、Indices等。</td>
</tr>
<tr>
<td>plugins</td>
<td>已安装插件目录</td>
</tr>
</tbody></table>
<p><strong>2）配置JDK环境</strong></p>
<ul>
<li><p>ES比较耗内存，建议虚拟机4G或以上内存，jvm1g以上的内存分配</p>
</li>
<li><p>运行Elasticsearch，需安装并配置JDK。各个版本对Java的依赖 <a target="_blank" rel="noopener" href="https://www.elastic.co/support/matrix#matrix_jvm">https://www.elastic.co/support/matrix#matrix_jvm</a></p>
</li>
<li><ul>
<li>Elasticsearch 5需要Java 8以上的版本	</li>
<li>Elasticsearch 从6.5开始支持Java 11</li>
<li>7.0开始，内置了Java环境。ES的JDK环境变量生效的优先级配置顺序ES_JAVA_HOME&gt;JAVA_HOME&gt;ES_HOME</li>
<li>ES_JAVA_HOME：这个环境变量用于指定Elasticsearch使用的Java运行时环境的路径。在启动Elasticsearch时，它会检查ES_JAVA_HOME环境变量并使用其中的Java路径。</li>
<li>ES_HOME：这个环境变量指定Elasticsearch的安装路径。它用于定位Elasticsearch的配置文件、插件和其他相关资源。设置ES_HOME环境变量可以让您在命令行中更方便地访问Elasticsearch的目录结构和文件。</li>
</ul>
</li>
</ul>
<p>可以参考es的环境文件elasticsearch-env.bat</p>
<p><img src="/../img/1718119979786.png" alt="1718119979786"></p>
<p>windows下，设置ES_JAVA_HOME和ES_HOME的环境变量</p>
<p><img src="/../img/1718119986671.png" alt="1718119986671"></p>
<p><strong>3）启动ElasticSearch服务</strong></p>
<p>进入bin目录，直接运行elasticsearch.bat</p>
<p>测试，浏览器中访问：<a target="_blank" rel="noopener" href="http://localhost:9200/">http://localhost:9200/</a></p>
<p><img src="/../img/1718120001960.png" alt="1718120001960"></p>
<h3 id="centos7安装ElasticSearch"><a href="#centos7安装ElasticSearch" class="headerlink" title="centos7安装ElasticSearch"></a><strong>centos7安装ElasticSearch</strong></h3><p>centos7中ES环境搭建视频：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1PsTNbpDy--M-pvFWb3aehQ?pwd=nwxl">https://pan.baidu.com/s/1PsTNbpDy--M-pvFWb3aehQ?pwd=nwxl</a></p>
<p><strong>1）下载ElasticSearch</strong></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">centos7</span> </span><br><span class="line">wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.17.3-linux-x86_64.tar.gz</span><br></pre></td></tr></tbody></table></figure>

<p><strong>2）配置JDK环境</strong></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">linux  进入用户主目录，比如/home/es目录下，设置用户级别的环境变量</span></span><br><span class="line">vim .bash_profile</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">设置ES_JAVA_HOME和ES_HOME的路径</span></span><br><span class="line">export ES_JAVA_HOME=/home/es/elasticsearch-7.17.3/jdk/</span><br><span class="line">export ES_HOME=/home/es/elasticsearch-7.17.3</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">执行以下命令使配置生效</span></span><br><span class="line">source .bash_profile</span><br></pre></td></tr></tbody></table></figure>

<p><strong>3) 配置ElasticSearch</strong></p>
<p>修改elasticsearch.yml配置</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim elasticsearch.yml</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">开启远程访问</span>  </span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">单节点模式   初学者建议设置为此模式</span> </span><br><span class="line">discovery.type: single-node</span><br></pre></td></tr></tbody></table></figure>

<p><strong>ElasticSearch配置参数</strong></p>
<p>参考： <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/important-settings.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.17/important-settings.html</a></p>
<ul>
<li>cluster.name</li>
</ul>
<p>当前节点所属集群名称，多个节点如果要组成同一个集群，那么集群名称一定要配置成相同。默认值elasticsearch，生产环境建议根据ES集群的使用目的修改成合适的名字。不要在不同的环境中重用相同的集群名称，否则，节点可能会加入错误的集群。</p>
<ul>
<li>node.name</li>
</ul>
<p>当前节点名称，默认值当前节点部署所在机器的主机名，所以如果一台机器上要起多个ES节点的话，需要通过配置该属性明确指定不同的节点名称。</p>
<ul>
<li>path.data</li>
</ul>
<p>配置数据存储目录，比如索引数据等，默认值 $ES_HOME/data，生产环境下强烈建议部署到另外的安全目录，防止ES升级导致数据被误删除。</p>
<ul>
<li>path.logs</li>
</ul>
<p>配置日志存储目录，比如运行日志和集群健康信息等，默认值 $ES_HOME/logs，生产环境下强烈建议部署到另外的安全目录，防止ES升级导致数据被误删除。</p>
<ul>
<li>bootstrap.memory_lock</li>
</ul>
<p>配置ES启动时是否进行内存锁定检查，默认值true。</p>
<p>ES对于内存的需求比较大，一般生产环境建议配置大内存，如果内存不足，容易导致内存交换到磁盘，严重影响ES的性能。所以默认启动时进行相应大小内存的锁定，如果无法锁定则会启动失败。</p>
<p>非生产环境可能机器内存本身就很小，能够供给ES使用的就更小，如果该参数配置为true的话很可能导致无法锁定内存以致ES无法成功启动，此时可以修改为false。</p>
<ul>
<li>network.host</li>
</ul>
<p>节点对外提供服务的地址以及集群内通信的ip地址，默认值为当前节点所在机器的本机回环地址127.0.0.1 和[::1]，这就导致默认情况下只能通过当前节点所在主机访问当前节点。</p>
<ul>
<li>http.port</li>
</ul>
<p>配置当前ES节点对外提供服务的http端口，默认 9200</p>
<ul>
<li>transport.port：</li>
</ul>
<p>节点通信端口号，默认 9300</p>
<ul>
<li>discovery.seed_hosts</li>
</ul>
<p>配置参与集群节点发现过程的主机列表，说白一点就是集群中所有节点所在的主机列表，可以是具体的IP地址，也可以是可解析的域名。</p>
<ul>
<li>cluster.initial_master_nodes</li>
</ul>
<p>配置ES集群初始化时参与master选举的节点名称列表，必须与node.name配置的一致。ES集群首次构建完成后，应该将集群中所有节点的配置文件中的cluster.initial_master_nodes配置项移除，重启集群或者将新节点加入某个已存在的集群时切记不要设置该配置项。</p>
<p><strong>4) 配置JVM参数</strong></p>
<p>修改config/jvm.options配置文件，调整jvm堆内存大小</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim jvm.options</span><br><span class="line">-Xms4g</span><br><span class="line">-Xmx4g</span><br></pre></td></tr></tbody></table></figure>

<p>配置的建议</p>
<ul>
<li>Xms和Xms设置成—样</li>
<li>Xmx不要超过机器内存的50%</li>
<li>不要超过30GB - <a target="_blank" rel="noopener" href="https://www.elastic.co/cn/blog/a-heap-of-trouble">https://www.elastic.co/cn/blog/a-heap-of-trouble</a></li>
</ul>
<p><strong>5）启动ElasticSearch服务</strong></p>
<p>ES不允许使用root账号启动服务，如果你当前账号是root，则需要创建一个专有账户</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">非root用户启动</span></span><br><span class="line">bin/elasticsearch </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-d 后台启动</span></span><br><span class="line">bin/elasticsearch -d</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/../img/1718120207157.png" alt="1718120207157"></p>
<p><font color="red">注意：es默认不能用root用户启动，生产环境建议为elasticsearch创建用户。</font></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">为elaticsearch创建用户并赋予相应权限</span></span><br><span class="line">adduser es</span><br><span class="line">passwd es</span><br><span class="line">chown -R es:es elasticsearch-7.17.3</span><br></pre></td></tr></tbody></table></figure>



<p><strong>6）启动ES服务常见错误解决方案</strong></p>
<p>如果ES服务启动异常，会有提示：</p>
<p><img src="/../img/1718120239475.png" alt="1718120239475"></p>
<p>[1]: max file descriptors [4096] for elasticsearch process is too low, increase to at least [65536]</p>
<p>ES因为需要大量的创建索引文件，需要大量的打开系统的文件，所以我们需要解除linux系统当中打开文件最大数目的限制，不然ES启动就会抛错</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">切换到root用户</span></span><br><span class="line">vim /etc/security/limits.conf</span><br><span class="line"></span><br><span class="line">末尾添加如下配置：</span><br><span class="line">  *        soft     nofile     65536</span><br><span class="line">  *     hard     nofile     65536</span><br><span class="line">  *     soft     nproc     4096</span><br><span class="line">  *        hard     nproc     4096</span><br></pre></td></tr></tbody></table></figure>

<p>[2]: max number of threads [1024] for user [es] is too low, increase to at least [4096]</p>
<p>无法创建本地线程问题,用户最大可创建线程数太小</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/security/limits.d/20-nproc.conf</span><br><span class="line"></span><br><span class="line">改为如下配置：</span><br><span class="line">* soft nproc 4096</span><br></pre></td></tr></tbody></table></figure>

<p>[3]: max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]</p>
<p>最大虚拟内存太小,调大系统的虚拟内存</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysctl.conf</span><br><span class="line">追加以下内容：</span><br><span class="line">vm.max_map_count=262144</span><br><span class="line">保存退出之后执行如下命令：</span><br><span class="line">sysctl -p</span><br></pre></td></tr></tbody></table></figure>

<p>[4]: the default discovery settings are unsuitable for production use; at least one of [discovery.seed_hosts, discovery.seed_providers, cluster.initial_master_nodes] must be configured</p>
<p>缺少默认配置，至少需要配置discovery.seed_hosts/discovery.seed_providers/cluster.initial_master_nodes中的一个参数.</p>
<ul>
<li>discovery.seed_hosts:  集群主机列表</li>
<li>discovery.seed_providers: 基于配置文件配置集群主机列表</li>
<li>cluster.initial_master_nodes: 启动时初始化的参与选主的node，生产环境必填</li>
</ul>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim config/elasticsearch.yml</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">添加配置</span></span><br><span class="line">discovery.seed_hosts: ["127.0.0.1"]</span><br><span class="line">cluster.initial_master_nodes: ["node-1"]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">或者指定配置单节点（集群单节点）</span></span><br><span class="line">discovery.type: single-node</span><br></pre></td></tr></tbody></table></figure>



<h3 id="Docker安装ElasticSearch"><a href="#Docker安装ElasticSearch" class="headerlink" title="Docker安装ElasticSearch"></a>Docker安装ElasticSearch</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/djdjfjf1/article/details/134775443">https://blog.csdn.net/djdjfjf1/article/details/134775443</a></p>
<h2 id="2、客户端Kibana安装"><a href="#2、客户端Kibana安装" class="headerlink" title="2、客户端Kibana安装"></a>2、客户端Kibana安装</h2><p>Kibana是一个开源分析和可视化平台，旨在与Elasticsearch协同工作。</p>
<p>参考文档：<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/kibana/7.17/get-started.html">https://www.elastic.co/guide/en/kibana/7.17/get-started.html</a></p>
<p><strong>1）下载并解压缩Kibana</strong></p>
<p>下载地址：<a target="_blank" rel="noopener" href="https://www.elastic.co/cn/downloads/past-releases#kibana">https://www.elastic.co/cn/downloads/past-releases#kibana</a></p>
<p>选择版本：7.17.3</p>
<p><img src="/../img/1718120311931.png" alt="1718120311931"></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">windows</span></span><br><span class="line">https://artifacts.elastic.co/downloads/kibana/kibana-7.17.3-windows-x86_64.zip</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">linux</span></span><br><span class="line">wget https://artifacts.elastic.co/downloads/kibana/kibana-7.17.3-linux-x86_64.tar.gz</span><br></pre></td></tr></tbody></table></figure>



<p><strong>2）修改Kibana.yml</strong></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim config/kibana.yml</span><br><span class="line"></span><br><span class="line">server.port: 5601   #指定Kibana服务器监听的端口号</span><br><span class="line">server.host: "localhost"  #指定Kibana服务器绑定的主机地址</span><br><span class="line">elasticsearch.hosts: ["http://localhost:9200"]  #指定Kibana连接到的Elasticsearch实例的访问地址</span><br><span class="line">i18n.locale: "zh-CN"   #将 Kibana 的界面语言设置为简体中文</span><br></pre></td></tr></tbody></table></figure>



<p><strong>3）运行Kibana</strong></p>
<p><strong>windows</strong></p>
<p>直接执行kibana.bat</p>
<p><strong>Linux</strong></p>
<p><font color="red">注意：kibana也需要非root用户启动</font></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bin/kibana</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">后台启动</span></span><br><span class="line">nohup  bin/kibana &amp;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查询kibana进程</span></span><br><span class="line">netstat -tunlp | grep 5601</span><br></pre></td></tr></tbody></table></figure>



<p><strong>4）访问Kibana:</strong> <a target="_blank" rel="noopener" href="http://localhost:5601/app/dev_tools#/console">http://localhost:5601/app/dev_tools#/console</a></p>
<p><img src="/../img/1718120378815.png" alt="1718120378815"></p>
<p><strong>cat API</strong></p>
<p>cat API 是 Elasticsearch 提供的一个用于查看和显示集群信息的 RESTful API。它可以用于获取关于索引、节点、分片、健康状态等各种集群相关的信息。</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">/_cat/allocation         #查看单节点的shard分配整体情况</span><br><span class="line">/_cat/shards          #查看各shard的详细情况</span><br><span class="line">/_cat/shards/{index}     #查看指定分片的详细情况</span><br><span class="line">/_cat/master          #查看master节点信息</span><br><span class="line">/_cat/nodes           #查看所有节点信息</span><br><span class="line">/_cat/indices         #查看集群中所有index的详细信息</span><br><span class="line">/_cat/indices/{index}      #查看集群中指定index的详细信息</span><br><span class="line">/_cat/segments        #查看各index的segment详细信息,包括segment名, 所属shard, 内存(磁盘)占用大小, 是否刷盘</span><br><span class="line">/_cat/segments/{index}#查看指定index的segment详细信息</span><br><span class="line">/_cat/count           #查看当前集群的doc数量</span><br><span class="line">/_cat/count/{index}   #查看指定索引的doc数量</span><br><span class="line">/_cat/recovery        #查看集群内每个shard的recovery过程.调整replica。</span><br><span class="line">/_cat/recovery/{index}#查看指定索引shard的recovery过程</span><br><span class="line">/_cat/health          #查看集群当前状态：红、黄、绿</span><br><span class="line">/_cat/pending_tasks   #查看当前集群的pending task</span><br><span class="line">/_cat/aliases         #查看集群中所有alias信息,路由配置等</span><br><span class="line">/_cat/aliases/{alias} #查看指定索引的alias信息</span><br><span class="line">/_cat/thread_pool     #查看集群各节点内部不同类型的threadpool的统计信息,</span><br><span class="line">/_cat/plugins         #查看集群各个节点上的plugin信息</span><br><span class="line">/_cat/fielddata       #查看当前集群各个节点的fielddata内存使用情况</span><br><span class="line">/_cat/fielddata/{fields}     #查看指定field的内存使用情况,里面传field属性对应的值</span><br><span class="line">/_cat/nodeattrs              #查看单节点的自定义属性</span><br><span class="line">/_cat/repositories           #输出集群中注册快照存储库</span><br><span class="line">/_cat/templates              #输出当前正在存在的模板信息</span><br></pre></td></tr></tbody></table></figure>



<h2 id="3、ElasticSearch安装分词插件"><a href="#3、ElasticSearch安装分词插件" class="headerlink" title="3、ElasticSearch安装分词插件"></a>3、ElasticSearch安装分词插件</h2><p><font color="red">Elasticsearch提供插件机制对系统进行扩展</font>，以安装分词插件为例：</p>
<h3 id="在线安装analysis-icu分词插件"><a href="#在线安装analysis-icu分词插件" class="headerlink" title="在线安装analysis-icu分词插件"></a><strong>在线安装analysis-icu分词插件</strong></h3><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看已安装插件</span></span><br><span class="line">bin/elasticsearch-plugin list</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装插件</span></span><br><span class="line">bin/elasticsearch-plugin install analysis-icu</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">删除插件</span></span><br><span class="line">bin/elasticsearch-plugin remove analysis-icu</span><br></pre></td></tr></tbody></table></figure>

<p><font color="red">注意：安装和删除完插件后，需要重启ES服务才能生效。</font></p>
<p>测试分词效果</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">_analyzer API可以用来查看指定分词器的分词结果</span></span><br><span class="line">POST _analyze</span><br><span class="line">{</span><br><span class="line">    "analyzer":"icu_analyzer",</span><br><span class="line">    "text":"中华人民共和国"</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/../img/1718120648835.png" alt="1718120648835"></p>
<h3 id="离线安装ik中文分词插件"><a href="#离线安装ik中文分词插件" class="headerlink" title="离线安装ik中文分词插件"></a><strong>离线安装ik中文分词插件</strong></h3><p>本地下载<a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.17.3/elasticsearch-analysis-ik-7.17.3.zip">elasticsearch-analysis-ik-7.17.3.zip</a>插件，解压，然后手动上传到elasticsearch的plugins目录，然后重启ES实例就可以了。</p>
<p>ik中文分词插件：<a target="_blank" rel="noopener" href="https://github.com/medcl/elasticsearch-analysis-ik">https://github.com/medcl/elasticsearch-analysis-ik</a></p>
<p>测试分词效果</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#ES的默认分词设置是standard，会单字拆分</span><br><span class="line">POST _analyze</span><br><span class="line">{</span><br><span class="line">    <span class="string">"analyzer"</span>:<span class="string">"standard"</span>,</span><br><span class="line">    <span class="string">"text"</span>:<span class="string">"中华人民共和国"</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">#ik_smart:会做最粗粒度的拆</span><br><span class="line">POST _analyze</span><br><span class="line">{</span><br><span class="line">    <span class="string">"analyzer"</span>: <span class="string">"ik_smart"</span>,</span><br><span class="line">    <span class="string">"text"</span>: <span class="string">"中华人民共和国"</span></span><br><span class="line"> }</span><br><span class="line"></span><br><span class="line">#ik_max_word:会将文本做最细粒度的拆分</span><br><span class="line">POST _analyze</span><br><span class="line">{</span><br><span class="line">    <span class="string">"analyzer"</span>:<span class="string">"ik_max_word"</span>,</span><br><span class="line">    <span class="string">"text"</span>:<span class="string">"中华人民共和国"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h1 id="四、ElasticSearch快速开始"><a href="#四、ElasticSearch快速开始" class="headerlink" title="四、ElasticSearch快速开始"></a>四、ElasticSearch快速开始</h1><h2 id="1、ElasticSearch核心概念"><a href="#1、ElasticSearch核心概念" class="headerlink" title="1、ElasticSearch核心概念"></a>1、ElasticSearch核心概念</h2><h3 id="节点：Node"><a href="#节点：Node" class="headerlink" title="节点：Node"></a><strong>节点：Node</strong></h3><p>一个节点就是一个Elasticsearch的实例，可以理解为一个 ES 的进程。</p>
<p><font color="red">注意：一个节点 ≠ 一台服务器</font></p>
<p><img src="/../img/1718516638253.png" alt="1718516638253"></p>
<h3 id="角色：Roles"><a href="#角色：Roles" class="headerlink" title="角色：Roles"></a><strong>角色：Roles</strong></h3><p>ES的角色分类：</p>
<ul>
<li>主节点（active master）：一般指活跃的主节点，一个集群中只能有一个，主要作用是对集群的管理。</li>
<li>候选节点（master-eligible）：当主节点发生故障时，参与选举，也就是主节点的替代节点。</li>
<li>数据节点（data node）：数据节点保存包含已编入索引的文档的分片。数据节点处理数据相关操作，如 CRUD、搜索和聚合。这些操作是 I/O 密集型、内存密集型和 CPU 密集型的。监控这些资源并在它们过载时添加更多数据节点非常重要。</li>
<li>预处理节点（ingest node）：预处理节点有点类似于logstash的消息管道，所以也叫ingest pipeline，常用于一些数据写入之前的预处理操作。</li>
</ul>
<p><font color="red">注意：如果 node.roles 为缺省配置，那么当前节点具备所有角色。</font></p>
<h3 id="索引：Index"><a href="#索引：Index" class="headerlink" title="索引：Index"></a><strong>索引：Index</strong></h3><p>索引在 ES 中所表述的含义和 MySQL 中的索引完全不同，在 MySQL 中索引指的是加速数据查询的一种特殊的数据结构，如 normal index。</p>
<p>而在 ES 中，索引表述的含义等价于 MySQL 中的表（仅针对 ES 7.x 以后版本），注意这里只是类比去理解，索引并不等于表。</p>
<p><font color="red">在 ES 中，索引在不同的特定条件下可以表示三种不同的意思：</font></p>
<ul>
<li><font color="red">表示源文件数据</font>：当做数据的载体，即类比为数据表，通常称作 index 。例如：通常说集群中有 product 索引，即表述当前 ES 的服务中存储了 product 这样一张“表”。</li>
<li><font color="red">表示索引文件</font>：以加速查询检索为目的而设计和创建的数据文件，通常承载于某些特定的数据结构，如哈希、FST 等。例如：通常所说的 正排索引 和 倒排索引（也叫正向索引和反向索引）。就是当前这个表述，索引文件和源数据是完全独立的，索引文件存在的目的仅仅是为了加快数据的检索，不会对源数据造成任何影响，</li>
<li><font color="red">表示创建数据的动作</font>：通常说创建或添加一条数据，在 ES 的表述为索引一条数据或索引一条文档，或者 index 一个 doc 进去。此时索引一条文档的含义为向索引中添加数据。</li>
</ul>
<p><strong>索引的组成部分：</strong></p>
<ul>
<li>alias：索引别名</li>
<li>settings：索引设置，常见设置如分片和副本的数量等。</li>
<li>mapping：映射，定义了索引中包含哪些字段，以及字段的类型、长度、分词器等。</li>
</ul>
<p><img src="/../img/1718516874336.png" alt="1718516874336"></p>
<h3 id="类型：Type（ES-7-x-之后版本已删除此概念）"><a href="#类型：Type（ES-7-x-之后版本已删除此概念）" class="headerlink" title="类型：Type（ES 7.x 之后版本已删除此概念）"></a><strong>类型：Type（ES 7.x 之后版本已删除此概念）</strong></h3><p>在较早的ES版本中，索引可以包含多个类型，每个类型代表了不同的文档结构。然而，<font color="red">从ES 7.x版本开始，类型已经被弃用</font>，一个索引只能包含一个文档类型。</p>
<p><strong>ES 7.x</strong></p>
<ul>
<li>不推荐在请求中指定类型。例如，索引文档不再需要文档type。新的索引 API 适用PUT {index}/_doc/{id}于显式 ID 和POST {index}/_doc 自动生成的 ID。请注意，在 7.0 中，_doc是路径的永久部分，表示端点名称而不是文档类型。</li>
<li>索引创建、索引模板和映射 API 中的include_type_name参数将默认为false. 完全设置参数将导致弃用警告。</li>
<li>_default_映射类型被删除 。</li>
</ul>
<p><strong>ES 8.x</strong></p>
<ul>
<li>不再支持在请求中指定类型。</li>
<li>该include_type_name参数被删除。</li>
</ul>
<h3 id="文档：Document"><a href="#文档：Document" class="headerlink" title="文档：Document"></a><strong>文档：Document</strong></h3><p><font color="red">文档是ES中的最小数据单元</font>。它是一个具有结构化JSON格式的记录。文档可以被索引并进行搜索、更新和删除操作。</p>
<p><img src="/../img/1718517145800.png" alt="1718517145800"></p>
<p>文档元数据，所有字段均以下划线开头，为系统字段，用于标注文档的相关信息：</p>
<ul>
<li><font color="red">_index：文档所属的索引名</font></li>
<li>_type：文档所属的类型名</li>
<li>_id：文档唯一id</li>
<li><font color="red">_source: 文档的原始Json数据</font></li>
<li>_version:  文档的版本号，修改删除操作_version都会自增1</li>
<li>_seq_no:  和_version一样，一旦数据发生更改，数据也一直是累计的。Shard级别严格递增，保证后写入的Doc的_seq_no大于先写入的Doc的_seq_no。</li>
<li>_primary_term: _primary_term主要是用来恢复数据时处理当多个文档的_seq_no一样时的冲突，避免Primary Shard上的写入被覆盖。每当Primary Shard发生重新分配时，比如重启，Primary选举等，_primary_term会递增1。</li>
</ul>
<h2 id="2、ElasticSearch索引操作"><a href="#2、ElasticSearch索引操作" class="headerlink" title="2、ElasticSearch索引操作"></a>2、<strong>ElasticSearch索引操作</strong></h2><p>参考文档：<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/index.html">https://www.elastic.co/guide/en/elasticsearch/reference/7.17/index.html</a></p>
<h3 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a><strong>创建索引</strong></h3><p>格式: PUT /索引名称</p>
<p><font color="red">索引命名规范：</font></p>
<ul>
<li>以小写英文字母命名索引</li>
<li>不要使用驼峰命名法则</li>
<li>如过出现多个单词的索引名称，以全小写 + 下划线分隔的方式：如test_index。</li>
</ul>
<p>ES 索引创建成功之后，以下属性将不可修改</p>
<ul>
<li>索引名称</li>
<li>主分片数量</li>
<li>字段类型</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PUT /es_db</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/../img/1718517355388.png" alt="1718517355388"></p>
<h3 id="查询索引"><a href="#查询索引" class="headerlink" title="查询索引"></a>查询索引</h3><p>格式: GET /索引名称</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#查询索引</span><br><span class="line"><span class="variable constant_">GET</span> /es_db</span><br><span class="line"></span><br><span class="line">#es_db是否存在</span><br><span class="line"><span class="variable constant_">HEAD</span> /es_db</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/../img/1718517410042.png" alt="1718517410042"></p>
<h3 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a><strong>删除索引</strong></h3><p>格式: DELETE /索引名称</p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">DELETE</span> /es_db</span><br></pre></td></tr></tbody></table></figure>

<h3 id="设置-Settings"><a href="#设置-Settings" class="headerlink" title="设置 Settings"></a><strong>设置 Settings</strong></h3><p>创建索引的时候指定 settings</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PUT &lt;index_name&gt;</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"settings"</span><span class="punctuation">:</span> <span class="punctuation">{</span><span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<p>创建索引时可以设置分片数和副本数</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#创建索引es_db，指定其主分片数量为 <span class="number">3</span>，每个主分片的副本数量为 <span class="number">2</span></span><br><span class="line">PUT /es_db</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"settings"</span> <span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"number_of_shards"</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"number_of_replicas"</span> <span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<p>创建索引时可以指定IK分词器作为默认分词器</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PUT /es_db</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"settings"</span> <span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"index"</span> <span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"analysis.analyzer.default.type"</span><span class="punctuation">:</span> <span class="string">"ik_max_word"</span></span><br><span class="line">        <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/../img/1718517528689.png" alt="1718517528689"></p>
<h4 id="静态索引设置"><a href="#静态索引设置" class="headerlink" title="静态索引设置"></a><strong>静态索引设置</strong></h4><p>只能在创建索引时或在关闭状态的索引上设置。</p>
<ul>
<li>index.number_of_shards：索引的主分片的个数，默认为 1，此设置只能在创建索引时设置</li>
</ul>
<h4 id="动态索引设置"><a href="#动态索引设置" class="headerlink" title="动态索引设置"></a><strong>动态索引设置</strong></h4><p>即可以使用 _setting API 在实时修改的配置项。</p>
<ul>
<li>index.number_of_replicas：每个主分片的副本数。默认为 1，允许配置为 0。</li>
<li>index.refresh_interval：执行刷新操作的频率，默认为1s. 可以设置 -1 为禁用刷新。</li>
<li>index.max_result_window：from + size 搜索此索引 的最大值，默认为 10000。</li>
</ul>
<p>使用 _setting 只能修改允许动态修改的配置项</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#修改索引配置，把每个主分片的副本数量修改为 <span class="number">1</span></span><br><span class="line">PUT /es_db/_settings</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"index"</span> <span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"number_of_replicas"</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="设置文档映射Mapping"><a href="#设置文档映射Mapping" class="headerlink" title="设置文档映射Mapping"></a><strong>设置文档映射Mapping</strong></h3><p>ES 中的 mapping 有点类似与关系数据库中表结构的概念，在 MySQL 中，表结构里包含了字段名称，字段的类型还有索引信息等。在 Mapping 里也包含了一些属性，比如字段名称、类型、字段使用的分词器、是否评分、是否创建索引等属性，并且在 ES 中一个字段可以有多个类型。<font color="red">ES中Mapping可以分为动态映射和静态映射。</font></p>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">查看完整的索引 mapping</span><br><span class="line"><span class="variable constant_">GET</span> /&lt;index_name&gt;/_mappings</span><br><span class="line"></span><br><span class="line">查看索引中指定字段的 mapping</span><br><span class="line"><span class="variable constant_">GET</span> /&lt;index_name&gt;<span class="regexp">/_mappings/</span>field/&lt;field_name&gt;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>mapping 的使用禁忌</strong></p>
<ul>
<li>ES 没有隐式类型转换</li>
<li>ES 不支持类型修改</li>
<li>生产环境尽可能的避免使用 <strong>动态映射（</strong>dynamic mapping）</li>
</ul>
<h4 id="动态映射"><a href="#动态映射" class="headerlink" title="动态映射"></a><strong>动态映射</strong></h4><p>在关系数据库中，需要事先创建数据库，然后在该数据库下创建数据表，并创建表字段、类型、长度、主键等，最后才能基于表插入数据。而Elasticsearch中不需要定义Mapping映射，<font color="red">在文档写入Elasticsearch时，会根据文档字段自动识别类型，这种机制称之为动态映射。</font></p>
<p><strong>自动类型推断规则</strong></p>
<p><img src="/../img/1718517662009.png" alt="1718517662009"></p>
<p>示例</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#删除原索引</span><br><span class="line">DELETE /user</span><br><span class="line"></span><br><span class="line">#创建文档(ES根据数据类型<span class="punctuation">,</span> 会自动创建映射)</span><br><span class="line">PUT /user/_doc/<span class="number">1</span></span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"name"</span><span class="punctuation">:</span><span class="string">"fox"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"age"</span><span class="punctuation">:</span><span class="number">32</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"address"</span><span class="punctuation">:</span><span class="string">"长沙麓谷"</span></span><br><span class="line"><span class="punctuation">}</span></span><br><span class="line"></span><br><span class="line">#获取文档映射</span><br><span class="line">GET /user/_mapping</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/../img/1718517681475.png" alt="1718517681475"></p>
<h4 id="静态映射"><a href="#静态映射" class="headerlink" title="静态映射"></a><strong>静态映射</strong></h4><p>静态映射也叫做显式映射，即：在索引文档写入之前，人为创建索引并且指定索引中每个字段类型、分词器等参数。</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">PUT /user</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"settings"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"number_of_shards"</span><span class="punctuation">:</span> <span class="string">"1"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"number_of_replicas"</span><span class="punctuation">:</span> <span class="string">"1"</span></span><br><span class="line">  <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"mappings"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"properties"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"keyword"</span></span><br><span class="line">      <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"age"</span> <span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">          <span class="attr">"type"</span> <span class="punctuation">:</span> <span class="string">"long"</span></span><br><span class="line">      <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"address"</span> <span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">          <span class="attr">"type"</span> <span class="punctuation">:</span> <span class="string">"text"</span></span><br><span class="line">      <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="常用Mapping参数配置"><a href="#常用Mapping参数配置" class="headerlink" title="常用Mapping参数配置"></a><strong>常用Mapping参数配置</strong></h4><table>
<thead>
<tr>
<th><strong>参数名称</strong></th>
<th><strong>释义</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>analyzer</strong></td>
<td><strong>指定分析器，只有 text 类型字段支持。</strong></td>
</tr>
<tr>
<td>copy_to</td>
<td>该参数允许将多个字段的值复制到组字段中，然后可以将其作为单个字段进行查询</td>
</tr>
<tr>
<td><strong>dynamic</strong></td>
<td>控制是否可以动态添加新字段，支持以下四个选项：<strong>true</strong>：（默认）允许动态映射<strong>false</strong>：忽略新字段。这些字段不会被索引或搜索，但仍会出现在_source返回的命中字段中。这些字段不会添加到映射中，必须显式添加新字段。<strong>runtime</strong>：新字段作为运行时字段添加到索引中，这些字段没有索引，是_source在查询时加载的。<strong>strict</strong>：如果检测到新字段，则会抛出异常并拒绝文档。必须将新字段显式添加到映射中。</td>
</tr>
<tr>
<td><strong>doc_values</strong></td>
<td>为了提升排序和聚合效率，默认true，如果确定不需要对字段进行排序或聚合，也不需要通过脚本访问字段值，则可以禁用doc值以节省磁盘空间（不支持 text 和 annotated_text）</td>
</tr>
<tr>
<td>eager_global_ordinals</td>
<td>用于聚合的字段上，优化聚合性能。</td>
</tr>
<tr>
<td>enabled</td>
<td>是否创建倒排索引，可以对字段操作，也可以对索引操作，如果不创建索引，任然可以检索并在_source元数据中展示，谨慎使用，该状态无法修改。</td>
</tr>
<tr>
<td><strong>fielddata</strong></td>
<td>查询时内存数据结构，在首次用当前字段聚合、排序或者在脚本中使用时，需要字段为fielddata数据结构，并且创建倒排索引保存到堆中</td>
</tr>
<tr>
<td><strong>fields</strong></td>
<td>给 field 创建多字段，用于不同目的（全文检索或者聚合分析排序）</td>
</tr>
<tr>
<td><strong>format</strong></td>
<td>用于格式化代码，如”data”:{    “type”: “data”,    “format”: “yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis” }</td>
</tr>
<tr>
<td><strong>index</strong></td>
<td>是否对创建对当前字段创建倒排索引，默认 true，如果不创建索引，该字段不会通过索引被搜索到,但是仍然会在 source 元数据中展示。</td>
</tr>
<tr>
<td><strong>norms</strong></td>
<td>是否禁用评分（在filter和聚合字段上应该禁用）</td>
</tr>
<tr>
<td><strong>null_value</strong></td>
<td>为 null 值设置默认值</td>
</tr>
<tr>
<td><strong>search_analyzer</strong></td>
<td>设置单独的查询时分析器</td>
</tr>
</tbody></table>
<p>示例：</p>
<ul>
<li>index: 控制当前字段是否被索引，默认为true。<font color="red">如果设置为false，该字段不可被搜索</font></li>
</ul>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">DELETE /user</span><br><span class="line">PUT /user</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"mappings"</span> <span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"properties"</span> <span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"address"</span> <span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">          <span class="attr">"type"</span> <span class="punctuation">:</span> <span class="string">"text"</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">"index"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">        <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"age"</span> <span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">          <span class="attr">"type"</span> <span class="punctuation">:</span> <span class="string">"long"</span></span><br><span class="line">        <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"name"</span> <span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">          <span class="attr">"type"</span> <span class="punctuation">:</span> <span class="string">"text"</span></span><br><span class="line">        <span class="punctuation">}</span></span><br><span class="line">      <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br><span class="line"></span><br><span class="line">PUT /user/_doc/<span class="number">1</span></span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"name"</span><span class="punctuation">:</span><span class="string">"fox"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"address"</span><span class="punctuation">:</span><span class="string">"广州白云山公园"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"age"</span><span class="punctuation">:</span><span class="number">30</span></span><br><span class="line"><span class="punctuation">}</span></span><br><span class="line"></span><br><span class="line">GET /user</span><br><span class="line"></span><br><span class="line">GET /user/_search</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"query"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"match"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"address"</span><span class="punctuation">:</span> <span class="string">"广州"</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/../img/1718517743532.png" alt="1718517743532"></p>
<ul>
<li>dynamic设为true时，一旦有新增字段的文档写入，Mapping 也同时被更新；dynamic设置成strict(严格控制策略)，文档写入失败，抛出异常</li>
</ul>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">PUT /user</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"mappings"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"dynamic"</span><span class="punctuation">:</span> <span class="string">"strict"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"properties"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"text"</span></span><br><span class="line">      <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"address"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"object"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"dynamic"</span><span class="punctuation">:</span> <span class="string">"true"</span></span><br><span class="line">      <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br><span class="line"># 插入文档报错，原因为age为新增字段<span class="punctuation">,</span>会抛出异常</span><br><span class="line">PUT /user/_doc/<span class="number">1</span></span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"name"</span><span class="punctuation">:</span><span class="string">"fox"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"age"</span><span class="punctuation">:</span><span class="number">32</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"address"</span><span class="punctuation">:</span><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"province"</span><span class="punctuation">:</span><span class="string">"湖南"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"city"</span><span class="punctuation">:</span><span class="string">"长沙"</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span>	</span><br></pre></td></tr></tbody></table></figure>

<p>dynamic设置成strict，新增age字段导致文档插入失败</p>
<p><img src="/../img/1718517798460.png" alt="1718517798460"></p>
<p>修改dynamic后再次插入文档成功</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#修改daynamic</span><br><span class="line">PUT /user/_mapping</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"dynamic"</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<p>注意：对已有字段，一旦已经有数据写入，就不再支持修改字段定义</p>
<ul>
<li><ul>
<li>Lucene 实现的倒排索引，一旦生成后，就不允许修改</li>
<li>如果希望改变字段类型，可以利用 reindex API，重建索引</li>
</ul>
</li>
</ul>
<h3 id="使用ReIndex重建索引"><a href="#使用ReIndex重建索引" class="headerlink" title="使用ReIndex重建索引"></a><strong>使用ReIndex重建索引</strong></h3><p>具体方法：</p>
<p>   1）如果要推倒现有的映射, 你得重新建立一个静态索引		</p>
<p>   2）然后把之前索引里的数据导入到新的索引里		</p>
<p>   3）删除原创建的索引		</p>
<p>   4）为新索引起个别名, 为原索引名	</p>
<p><font color="red">通过这几个步骤可以实现了索引的平滑过渡,并且是零停机</font></p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">1.</span> 重新建立一个静态索引    </span><br><span class="line">PUT /user2</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"mappings"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"properties"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"name"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"text"</span></span><br><span class="line">      <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"address"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"type"</span><span class="punctuation">:</span> <span class="string">"text"</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">"analyzer"</span><span class="punctuation">:</span> <span class="string">"ik_max_word"</span></span><br><span class="line">      <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br><span class="line"># <span class="number">2.</span> 把之前索引里的数据导入到新的索引里    </span><br><span class="line">POST _reindex</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line"><span class="attr">"source"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line"><span class="attr">"index"</span><span class="punctuation">:</span> <span class="string">"user"</span></span><br><span class="line"><span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"dest"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line"><span class="attr">"index"</span><span class="punctuation">:</span> <span class="string">"user2"</span></span><br><span class="line"><span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br><span class="line"># <span class="number">3.</span> 删除原创建的索引        </span><br><span class="line">DELETE /user</span><br><span class="line"># <span class="number">4.</span> 为新索引起个别名<span class="punctuation">,</span> 为原索引名</span><br><span class="line">PUT /user2/_alias/user</span><br><span class="line"></span><br><span class="line">GET /user</span><br></pre></td></tr></tbody></table></figure>

<h2 id="3、ElasticSearch文档操作"><a href="#3、ElasticSearch文档操作" class="headerlink" title="3、ElasticSearch文档操作"></a>3、<strong>ElasticSearch文档操作</strong></h2><p>示例数据</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">PUT /es_db</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"settings"</span> <span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"index"</span> <span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">            <span class="attr">"analysis.analyzer.default.type"</span><span class="punctuation">:</span> <span class="string">"ik_max_word"</span></span><br><span class="line">        <span class="punctuation">}</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br><span class="line"></span><br><span class="line">PUT /es_db/_doc/<span class="number">1</span></span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line"><span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"张三"</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"sex"</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"age"</span><span class="punctuation">:</span> <span class="number">25</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"address"</span><span class="punctuation">:</span> <span class="string">"广州天河公园"</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"remark"</span><span class="punctuation">:</span> <span class="string">"java developer"</span></span><br><span class="line"><span class="punctuation">}</span></span><br><span class="line">PUT /es_db/_doc/<span class="number">2</span></span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line"><span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"李四"</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"sex"</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"age"</span><span class="punctuation">:</span> <span class="number">28</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"address"</span><span class="punctuation">:</span> <span class="string">"广州荔湾大厦"</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"remark"</span><span class="punctuation">:</span> <span class="string">"java assistant"</span></span><br><span class="line"><span class="punctuation">}</span></span><br><span class="line"></span><br><span class="line">PUT /es_db/_doc/<span class="number">3</span></span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line"><span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"王五"</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"sex"</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"age"</span><span class="punctuation">:</span> <span class="number">26</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"address"</span><span class="punctuation">:</span> <span class="string">"广州白云山公园"</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"remark"</span><span class="punctuation">:</span> <span class="string">"php developer"</span></span><br><span class="line"><span class="punctuation">}</span></span><br><span class="line"></span><br><span class="line">PUT /es_db/_doc/<span class="number">4</span></span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line"><span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"赵六"</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"sex"</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"age"</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"address"</span><span class="punctuation">:</span> <span class="string">"长沙橘子洲"</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"remark"</span><span class="punctuation">:</span> <span class="string">"python assistant"</span></span><br><span class="line"><span class="punctuation">}</span></span><br><span class="line"></span><br><span class="line">PUT /es_db/_doc/<span class="number">5</span></span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line"><span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"张龙"</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"sex"</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"age"</span><span class="punctuation">:</span> <span class="number">19</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"address"</span><span class="punctuation">:</span> <span class="string">"长沙麓谷企业广场"</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"remark"</span><span class="punctuation">:</span> <span class="string">"java architect assistant"</span></span><br><span class="line"><span class="punctuation">}</span>    </span><br><span class="line">    </span><br><span class="line">PUT /es_db/_doc/<span class="number">6</span></span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line"><span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"赵虎"</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"sex"</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"age"</span><span class="punctuation">:</span> <span class="number">32</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"address"</span><span class="punctuation">:</span> <span class="string">"长沙麓谷兴工国际产业园"</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"remark"</span><span class="punctuation">:</span> <span class="string">"java architect"</span></span><br><span class="line"><span class="punctuation">}</span>    </span><br><span class="line"></span><br><span class="line">PUT /es_db/_doc/<span class="number">7</span></span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line"><span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"李虎"</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"sex"</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"age"</span><span class="punctuation">:</span> <span class="number">32</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"address"</span><span class="punctuation">:</span> <span class="string">"广州番禺节能科技园"</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"remark"</span><span class="punctuation">:</span> <span class="string">"java architect"</span></span><br><span class="line"><span class="punctuation">}</span></span><br><span class="line"></span><br><span class="line">PUT /es_db/_doc/<span class="number">8</span></span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line"><span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"张星"</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"sex"</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"age"</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"address"</span><span class="punctuation">:</span> <span class="string">"武汉东湖高新区未来智汇城"</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"remark"</span><span class="punctuation">:</span> <span class="string">"golang developer"</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="索引文档"><a href="#索引文档" class="headerlink" title="索引文档"></a><strong>索引文档</strong></h3><ul>
<li>格式: [PUT | POST] /索引名称/[_doc  | _create ]/id</li>
</ul>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 创建文档<span class="punctuation">,</span>指定id</span><br><span class="line"># 如果id不存在，创建新的文档，否则先删除现有文档，再创建新的文档，版本会增加</span><br><span class="line">PUT /es_db/_doc/<span class="number">1</span></span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line"><span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"张三"</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"sex"</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"age"</span><span class="punctuation">:</span> <span class="number">25</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"address"</span><span class="punctuation">:</span> <span class="string">"广州天河公园"</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"remark"</span><span class="punctuation">:</span> <span class="string">"java developer"</span></span><br><span class="line"><span class="punctuation">}</span>    </span><br><span class="line"></span><br><span class="line">#创建文档，ES生成id</span><br><span class="line">POST /es_db/_doc</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line"><span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"张三"</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"sex"</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"age"</span><span class="punctuation">:</span> <span class="number">25</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"address"</span><span class="punctuation">:</span> <span class="string">"广州天河公园"</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">"remark"</span><span class="punctuation">:</span> <span class="string">"java developer"</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/../img/1718517911985.png" alt="1718517911985"></p>
<p><font color="red">注意:POST和PUT都能起到创建/更新的作用，PUT需要对一个具体的资源进行操作也就是要确定id才能进行更新/创建</font>，而POST是可以针对整个资源集合进行操作的，如果不写id就由ES生成一个唯一id进行创建新文档，如果填了id那就针对这个id的文档进行创建/更新</p>
<p><img src="/../img/1718517929381.png" alt="1718517929381"></p>
<p><strong>create: 如果ID已经存在，会失败</strong></p>
<p><img src="/../img/1718517935256.png" alt="1718517935256"></p>
<h3 id="查询文档"><a href="#查询文档" class="headerlink" title="查询文档"></a><strong>查询文档</strong></h3><ul>
<li>根据id查询文档，格式: GET /索引名称/_doc/id</li>
</ul>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">GET</span> /es_db/_doc/<span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>条件查询 _search，格式： /索引名称/_doc/_search</li>
</ul>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 查询前<span class="number">10</span>条文档</span><br><span class="line"><span class="variable constant_">GET</span> /es_db/_doc/_search</span><br></pre></td></tr></tbody></table></figure>

<p>ES Search API提供了两种条件查询搜索方式：</p>
<ul>
<li>REST风格的请求URI，直接将参数带过去</li>
<li>封装到request body中，这种方式可以定义更加易读的JSON格式</li>
</ul>
<h3 id="URI-Query（了解即可）"><a href="#URI-Query（了解即可）" class="headerlink" title="URI Query（了解即可）"></a><strong>URI Query（了解即可）</strong></h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#通过<span class="variable constant_">URI</span>搜索，使用“q”指定查询字符串，“query string syntax” <span class="variable constant_">KV</span>键值对</span><br><span class="line"></span><br><span class="line">#条件查询, 如要查询age等于<span class="number">28</span>岁的 _search?q=*:***</span><br><span class="line"><span class="variable constant_">GET</span> /es_db/_doc/_search?q=<span class="attr">age</span>:<span class="number">28</span></span><br><span class="line"></span><br><span class="line">#范围查询, 如要查询age在<span class="number">25</span>至<span class="number">26</span>岁之间的 _search?q=***[** <span class="variable constant_">TO</span> **]  注意: <span class="variable constant_">TO</span> 必须为大写</span><br><span class="line"><span class="variable constant_">GET</span> /es_db/_doc/_search?q=age[<span class="number">25</span> <span class="variable constant_">TO</span> <span class="number">26</span>]</span><br><span class="line"></span><br><span class="line">#查询年龄小于等于<span class="number">28</span>岁的 :&lt;=</span><br><span class="line"><span class="variable constant_">GET</span> /es_db/_doc/_search?q=<span class="attr">age</span>:&lt;=<span class="number">28</span></span><br><span class="line">#查询年龄大于<span class="number">28</span>前的 :&gt;</span><br><span class="line"><span class="variable constant_">GET</span> /es_db/_doc/_search?q=<span class="attr">age</span>:&gt;<span class="number">28</span></span><br><span class="line"></span><br><span class="line">#分页查询 <span class="keyword">from</span>=*&amp;size=*</span><br><span class="line"><span class="variable constant_">GET</span> /es_db/_doc/_search?q=age[<span class="number">25</span> <span class="variable constant_">TO</span> <span class="number">26</span>]&amp;<span class="keyword">from</span>=<span class="number">0</span>&amp;size=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">#对查询结果只输出某些字段 _source=字段,字段</span><br><span class="line"><span class="variable constant_">GET</span> /es_db/_doc/_search?_source=name,age</span><br><span class="line"></span><br><span class="line">#对查询结果排序 sort=字段:desc/asc</span><br><span class="line"><span class="variable constant_">GET</span> /es_db/_doc/_search?sort=<span class="attr">age</span>:desc</span><br></pre></td></tr></tbody></table></figure>

<h3 id="DSL-Query"><a href="#DSL-Query" class="headerlink" title="DSL Query"></a><strong>DSL Query</strong></h3><p>DSL（Domain Specific Language领域专用语言）查询是使用Elasticsearch的查询语言来构建查询的方式。</p>
<p><font color="red">DSL Query会在后续课程中详细讲解</font></p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># match 匹配查询，会对查询文本分词后匹配</span><br><span class="line">GET /es_db/_search</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"query"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"match"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"address"</span><span class="punctuation">:</span> <span class="string">"广州白云"</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br><span class="line"></span><br><span class="line"># term 词项查询，属于精确查询，不会对查询文本分词</span><br><span class="line"># 思考：能否查到文档？</span><br><span class="line">GET /es_db/_search</span><br><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"query"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"term"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"address"</span><span class="punctuation">:</span> <span class="string">"广州白云"</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="修改文档"><a href="#修改文档" class="headerlink" title="修改文档"></a><strong>修改文档</strong></h3><ul>
<li>全量更新，整个json都会替换，格式: [PUT | POST] /索引名称/_doc/id</li>
</ul>
<p><font color="red">如果文档存在，现有文档会被删除，新的文档会被索引</font></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 全量更新，替换整个json</span><br><span class="line"><span class="variable constant_">PUT</span> /es_db/_doc/<span class="number">1</span></span><br><span class="line">{</span><br><span class="line"><span class="string">"name"</span>: <span class="string">"张三"</span>,</span><br><span class="line"><span class="string">"sex"</span>: <span class="number">1</span>,</span><br><span class="line"><span class="string">"age"</span>: <span class="number">25</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">#查询文档</span><br><span class="line"><span class="variable constant_">GET</span> /es_db/_doc/<span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/../img/1718518078287.png" alt="1718518078287"></p>
<ul>
<li>使用_update部分更新，格式: POST /索引名称/_update/id</li>
</ul>
<p><font color="red">update不会删除原来的文档，而是实现真正的数据更新</font></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 部分更新：在原有文档上更新</span><br><span class="line"># <span class="title class_">Update</span> -文档必须已经存在，更新只会对相应字段做增量修改</span><br><span class="line"><span class="variable constant_">POST</span> /es_db/_update/<span class="number">1</span></span><br><span class="line">{</span><br><span class="line">  <span class="string">"doc"</span>: {</span><br><span class="line">    <span class="string">"age"</span>: <span class="number">28</span></span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">#查询文档</span><br><span class="line"><span class="variable constant_">GET</span> /es_db/_doc/<span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/../img/1718518103507.png" alt="1718518103507"></p>
<ul>
<li>使用 _update_by_query 更新文档</li>
</ul>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">POST</span> /es_db/_update_by_query</span><br><span class="line">{</span><br><span class="line">  <span class="string">"query"</span>: { </span><br><span class="line">    <span class="string">"match"</span>: {</span><br><span class="line">      <span class="string">"_id"</span>: <span class="number">1</span></span><br><span class="line">    }</span><br><span class="line">  },</span><br><span class="line">  <span class="string">"script"</span>: {</span><br><span class="line">    <span class="string">"source"</span>: <span class="string">"ctx._source.age = 30"</span></span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/../img/1718518117630.png" alt="1718518117630"></p>
<h3 id="并发场景下修改文档"><a href="#并发场景下修改文档" class="headerlink" title="并发场景下修改文档"></a><strong>并发场景下修改文档</strong></h3><p>_seq_no和_primary_term是对_version的优化，7.X版本的ES默认使用这种方式控制版本，所以<font color="red">当在高并发环境下使用乐观锁机制修改文档时，要带上当前文档的_seq_no和_primary_term进行更新：</font></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">POST</span> /es_db/_doc/<span class="number">2</span>?if_seq_no=<span class="number">21</span>&amp;if_primary_term=<span class="number">6</span></span><br><span class="line">{</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"李四xxx"</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>如果版本号不对，会抛出版本冲突异常，如下图：</p>
<p><img src="/../img/1718518161774.png" alt="1718518161774"></p>
<h3 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a><strong>删除文档</strong></h3><p>格式: DELETE /索引名称/_doc/id</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">DELETE</span> /es_db/_doc/<span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="4、ElasticSearch文档批量操作"><a href="#4、ElasticSearch文档批量操作" class="headerlink" title="4、ElasticSearch文档批量操作"></a>4、<strong>ElasticSearch文档批量操作</strong></h2><p>批量操作可以减少网络连接所产生的开销，提升性能</p>
<ul>
<li><font color="red">支持在一次API调用中，对不同的索引进行操作</font></li>
<li>可以在URI中指定Index，也可以在请求的Payload中进行</li>
<li><font color="red">操作中单条操作失败，并不会影响其他操作</font></li>
<li>返回结果包括了每一条操作执行的结果</li>
</ul>
<h3 id="批量写入"><a href="#批量写入" class="headerlink" title="批量写入"></a><strong>批量写入</strong></h3><p><font color="red">批量对文档进行写操作是通过_bulk的API来实现的</font></p>
<ul>
<li><p>请求方式：POST</p>
</li>
<li><p>请求地址：_bulk</p>
</li>
<li><p>请求参数：通过_bulk操作文档，一般至少有两行参数(或偶数行参数)</p>
</li>
<li><ul>
<li>第一行参数为指定操作的类型及操作的对象(index,type和id)</li>
<li>第二行参数才是操作的数据</li>
</ul>
</li>
</ul>
<p>参数类似于：</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span><span class="attr">"actionName"</span><span class="punctuation">:</span><span class="punctuation">{</span><span class="attr">"_index"</span><span class="punctuation">:</span><span class="string">"indexName"</span><span class="punctuation">,</span> <span class="attr">"_type"</span><span class="punctuation">:</span><span class="string">"typeName"</span><span class="punctuation">,</span><span class="attr">"_id"</span><span class="punctuation">:</span><span class="string">"id"</span><span class="punctuation">}</span><span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">{</span><span class="attr">"field1"</span><span class="punctuation">:</span><span class="string">"value1"</span><span class="punctuation">,</span> <span class="attr">"field2"</span><span class="punctuation">:</span><span class="string">"value2"</span><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>actionName：表示操作类型，主要有create,index,delete和update</li>
</ul>
<h3 id="批量创建文档create"><a href="#批量创建文档create" class="headerlink" title="批量创建文档create"></a><strong>批量创建文档create</strong></h3><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _bulk</span><br><span class="line"><span class="punctuation">{</span><span class="attr">"create"</span><span class="punctuation">:</span><span class="punctuation">{</span><span class="attr">"_index"</span><span class="punctuation">:</span><span class="string">"article"</span><span class="punctuation">,</span> <span class="attr">"_type"</span><span class="punctuation">:</span><span class="string">"_doc"</span><span class="punctuation">,</span> <span class="attr">"_id"</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">}</span><span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">{</span><span class="attr">"id"</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">,</span><span class="attr">"title"</span><span class="punctuation">:</span><span class="string">"fox老师"</span><span class="punctuation">,</span><span class="attr">"content"</span><span class="punctuation">:</span><span class="string">"fox老师666"</span><span class="punctuation">,</span><span class="attr">"tags"</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">"java"</span><span class="punctuation">,</span> <span class="string">"面向对象"</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">"create_time"</span><span class="punctuation">:</span><span class="number">1554015482530</span><span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">{</span><span class="attr">"create"</span><span class="punctuation">:</span><span class="punctuation">{</span><span class="attr">"_index"</span><span class="punctuation">:</span><span class="string">"article"</span><span class="punctuation">,</span> <span class="attr">"_type"</span><span class="punctuation">:</span><span class="string">"_doc"</span><span class="punctuation">,</span> <span class="attr">"_id"</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">}</span><span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">{</span><span class="attr">"id"</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">,</span><span class="attr">"title"</span><span class="punctuation">:</span><span class="string">"mark老师"</span><span class="punctuation">,</span><span class="attr">"content"</span><span class="punctuation">:</span><span class="string">"mark老师NB"</span><span class="punctuation">,</span><span class="attr">"tags"</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">"java"</span><span class="punctuation">,</span> <span class="string">"面向对象"</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">"create_time"</span><span class="punctuation">:</span><span class="number">1554015482530</span><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="普通创建或全量替换index"><a href="#普通创建或全量替换index" class="headerlink" title="普通创建或全量替换index"></a><strong>普通创建或全量替换index</strong></h3><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _bulk</span><br><span class="line"><span class="punctuation">{</span><span class="attr">"index"</span><span class="punctuation">:</span><span class="punctuation">{</span><span class="attr">"_index"</span><span class="punctuation">:</span><span class="string">"article"</span><span class="punctuation">,</span> <span class="attr">"_type"</span><span class="punctuation">:</span><span class="string">"_doc"</span><span class="punctuation">,</span> <span class="attr">"_id"</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">}</span><span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">{</span><span class="attr">"id"</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">,</span><span class="attr">"title"</span><span class="punctuation">:</span><span class="string">"图灵徐庶老师"</span><span class="punctuation">,</span><span class="attr">"content"</span><span class="punctuation">:</span><span class="string">"图灵学院徐庶老师666"</span><span class="punctuation">,</span><span class="attr">"tags"</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">"java"</span><span class="punctuation">,</span> <span class="string">"面向对象"</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">"create_time"</span><span class="punctuation">:</span><span class="number">1554015482530</span><span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">{</span><span class="attr">"index"</span><span class="punctuation">:</span><span class="punctuation">{</span><span class="attr">"_index"</span><span class="punctuation">:</span><span class="string">"article"</span><span class="punctuation">,</span> <span class="attr">"_type"</span><span class="punctuation">:</span><span class="string">"_doc"</span><span class="punctuation">,</span> <span class="attr">"_id"</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">}</span><span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">{</span><span class="attr">"id"</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">,</span><span class="attr">"title"</span><span class="punctuation">:</span><span class="string">"图灵诸葛老师"</span><span class="punctuation">,</span><span class="attr">"content"</span><span class="punctuation">:</span><span class="string">"图灵学院诸葛老师NB"</span><span class="punctuation">,</span><span class="attr">"tags"</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">"java"</span><span class="punctuation">,</span> <span class="string">"面向对象"</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">"create_time"</span><span class="punctuation">:</span><span class="number">1554015482530</span><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>如果原文档不存在，则是创建</li>
<li>如果原文档存在，则是替换(全量修改原文档)</li>
</ul>
<h3 id="批量删除delete"><a href="#批量删除delete" class="headerlink" title="批量删除delete"></a><strong>批量删除delete</strong></h3><figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">POST</span> _bulk</span><br><span class="line">{<span class="string">"delete"</span>:{<span class="string">"_index"</span>:<span class="string">"article"</span>, <span class="string">"_type"</span>:<span class="string">"_doc"</span>, <span class="string">"_id"</span>:<span class="number">3</span>}}</span><br><span class="line">{<span class="string">"delete"</span>:{<span class="string">"_index"</span>:<span class="string">"article"</span>, <span class="string">"_type"</span>:<span class="string">"_doc"</span>, <span class="string">"_id"</span>:<span class="number">4</span>}}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="批量修改update"><a href="#批量修改update" class="headerlink" title="批量修改update"></a><strong>批量修改update</strong></h3><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _bulk</span><br><span class="line"><span class="punctuation">{</span><span class="attr">"update"</span><span class="punctuation">:</span><span class="punctuation">{</span><span class="attr">"_index"</span><span class="punctuation">:</span><span class="string">"article"</span><span class="punctuation">,</span> <span class="attr">"_type"</span><span class="punctuation">:</span><span class="string">"_doc"</span><span class="punctuation">,</span> <span class="attr">"_id"</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">}</span><span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">{</span><span class="attr">"doc"</span><span class="punctuation">:</span><span class="punctuation">{</span><span class="attr">"title"</span><span class="punctuation">:</span><span class="string">"ES大法必修内功"</span><span class="punctuation">}</span><span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">{</span><span class="attr">"update"</span><span class="punctuation">:</span><span class="punctuation">{</span><span class="attr">"_index"</span><span class="punctuation">:</span><span class="string">"article"</span><span class="punctuation">,</span> <span class="attr">"_type"</span><span class="punctuation">:</span><span class="string">"_doc"</span><span class="punctuation">,</span> <span class="attr">"_id"</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">}</span><span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">{</span><span class="attr">"doc"</span><span class="punctuation">:</span><span class="punctuation">{</span><span class="attr">"create_time"</span><span class="punctuation">:</span><span class="number">1554018421008</span><span class="punctuation">}</span><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="组合应用"><a href="#组合应用" class="headerlink" title="组合应用"></a><strong>组合应用</strong></h3><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST _bulk</span><br><span class="line"><span class="punctuation">{</span><span class="attr">"index"</span><span class="punctuation">:</span><span class="punctuation">{</span><span class="attr">"_index"</span><span class="punctuation">:</span><span class="string">"article"</span><span class="punctuation">,</span> <span class="attr">"_type"</span><span class="punctuation">:</span><span class="string">"_doc"</span><span class="punctuation">,</span> <span class="attr">"_id"</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">}</span><span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">{</span><span class="attr">"id"</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">,</span><span class="attr">"title"</span><span class="punctuation">:</span><span class="string">"fox老师"</span><span class="punctuation">,</span><span class="attr">"content"</span><span class="punctuation">:</span><span class="string">"fox老师666"</span><span class="punctuation">,</span><span class="attr">"tags"</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">"java"</span><span class="punctuation">,</span> <span class="string">"面向对象"</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">"create_time"</span><span class="punctuation">:</span><span class="number">1554015482530</span><span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">{</span><span class="attr">"delete"</span><span class="punctuation">:</span><span class="punctuation">{</span><span class="attr">"_index"</span><span class="punctuation">:</span><span class="string">"article"</span><span class="punctuation">,</span> <span class="attr">"_type"</span><span class="punctuation">:</span><span class="string">"_doc"</span><span class="punctuation">,</span> <span class="attr">"_id"</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">}</span><span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">{</span><span class="attr">"update"</span><span class="punctuation">:</span><span class="punctuation">{</span><span class="attr">"_index"</span><span class="punctuation">:</span><span class="string">"article"</span><span class="punctuation">,</span> <span class="attr">"_type"</span><span class="punctuation">:</span><span class="string">"_doc"</span><span class="punctuation">,</span> <span class="attr">"_id"</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">}</span><span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">{</span><span class="attr">"doc"</span><span class="punctuation">:</span><span class="punctuation">{</span><span class="attr">"create_time"</span><span class="punctuation">:</span><span class="number">1554018421008</span><span class="punctuation">}</span><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<h3 id="批量读取"><a href="#批量读取" class="headerlink" title="批量读取"></a><strong>批量读取</strong></h3><p>es的批量查询可以使用mget和msearch两种。其中mget是需要我们知道它的id，可以指定不同的index，也可以指定返回值source。msearch可以通过字段查询来进行一个批量的查找。</p>
<p><strong>_mget</strong></p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#可以通过<span class="variable constant_">ID</span>批量获取不同index和type的数据</span><br><span class="line"><span class="variable constant_">GET</span> _mget</span><br><span class="line">{</span><br><span class="line"><span class="string">"docs"</span>: [</span><br><span class="line">{</span><br><span class="line"><span class="string">"_index"</span>: <span class="string">"es_db"</span>,</span><br><span class="line"><span class="string">"_id"</span>: <span class="number">1</span></span><br><span class="line">},</span><br><span class="line">{</span><br><span class="line"><span class="string">"_index"</span>: <span class="string">"article"</span>,</span><br><span class="line"><span class="string">"_id"</span>: <span class="number">4</span></span><br><span class="line">}</span><br><span class="line">]</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">#可以通过<span class="variable constant_">ID</span>批量获取es_db的数据</span><br><span class="line"><span class="variable constant_">GET</span> /es_db/_mget</span><br><span class="line">{</span><br><span class="line"><span class="string">"docs"</span>: [</span><br><span class="line">{</span><br><span class="line"><span class="string">"_id"</span>: <span class="number">1</span></span><br><span class="line">},</span><br><span class="line">{</span><br><span class="line"><span class="string">"_id"</span>: <span class="number">4</span></span><br><span class="line">}</span><br><span class="line">]</span><br><span class="line">}</span><br><span class="line">#简化后</span><br><span class="line"><span class="variable constant_">GET</span> /es_db/_mget </span><br><span class="line">{</span><br><span class="line"> <span class="string">"ids"</span>:[<span class="string">"1"</span>,<span class="string">"2"</span>]  </span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/../img/1718518366257.png" alt="1718518366257"></p>
<p><strong>_msearch</strong></p>
<p>在_msearch中，请求格式和bulk类似。查询一条数据需要两个对象，第一个设置index和type，第二个设置查询语句。查询语句和search相同。如果只是查询一个index，我们可以在url中带上index，这样，如果查该index可以直接用空对象表示。</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">GET</span> /es_db/_msearch</span><br><span class="line">{}</span><br><span class="line">{<span class="string">"query"</span> : {<span class="string">"match_all"</span> : {}}, <span class="string">"from"</span> : <span class="number">0</span>, <span class="string">"size"</span> : <span class="number">2</span>}</span><br><span class="line">{<span class="string">"index"</span> : <span class="string">"article"</span>}</span><br><span class="line">{<span class="string">"query"</span> : {<span class="string">"match_all"</span> : {}}}</span><br></pre></td></tr></tbody></table></figure>

<p><img src="/../img/1718518388838.png" alt="1718518388838"></p>
<h2 id="5、Spring-Boot整合ElasticSearch实战"><a href="#5、Spring-Boot整合ElasticSearch实战" class="headerlink" title="5、Spring Boot整合ElasticSearch实战"></a>5、<strong>Spring Boot整合ElasticSearch实战</strong></h2><p>官方文档：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-data/elasticsearch/docs/current/reference/html/#new-features.4-4-0">https://docs.spring.io/spring-data/elasticsearch/docs/current/reference/html/#new-features.4-4-0</a></p>
<p> <strong>版本选择</strong></p>
<p><font color="red">Elasticsearch 7.17.3 对应依赖 Spring Data Elasticsearch 4.4.x，对应springboot版本2.7.x</font></p>
<p><img src="/../img/1718518722054.png" alt="1718518722054"></p>
<p><strong>引入依赖</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><img src="/../img/1718518741392.png" alt="1718518741392"></p>
<p><strong>yml配置</strong></p>
<figure class="highlight yml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">elasticsearch:</span></span><br><span class="line">    <span class="attr">uris:</span> <span class="string">http://localhost:9200</span></span><br><span class="line">    <span class="attr">connection-timeout:</span> <span class="string">3s</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>创建实体</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Document(indexName = "employees")</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> {</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="meta">@Field(type= FieldType.Keyword)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> sex;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="meta">@Field(type= FieldType.Text,analyzer="ik_max_word")</span></span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="keyword">private</span> String remark;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="实现ElasticsearchRepository"><a href="#实现ElasticsearchRepository" class="headerlink" title="实现ElasticsearchRepository"></a><strong>实现ElasticsearchRepository</strong></h3><p>该接口是框架封装的用于操作Elastsearch的高级接口</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmployeeRepository</span> <span class="keyword">extends</span> <span class="title class_">ElasticsearchRepository</span>&lt;Employee, Long&gt; {</span><br><span class="line">    List&lt;Employee&gt; <span class="title function_">findByName</span><span class="params">(String name)</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>测试</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">EmployeeRepository employeeRepository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDocument</span><span class="params">()</span> {</span><br><span class="line"></span><br><span class="line">    <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="number">1L</span>, <span class="string">"radish"</span>, <span class="number">1</span>, <span class="number">32</span>, <span class="string">"广东东莞"</span>, <span class="string">"java architect"</span>);</span><br><span class="line">    <span class="comment">//插入文档</span></span><br><span class="line">    employeeRepository.save(employee);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据id查询</span></span><br><span class="line">    Optional&lt;Employee&gt; result = employeeRepository.findById(<span class="number">1L</span>);</span><br><span class="line">    log.info(String.valueOf(result.get()));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据name查询</span></span><br><span class="line">    List&lt;Employee&gt; list = employeeRepository.findByName(<span class="string">"radish"</span>);</span><br><span class="line">    log.info(String.valueOf(list.get(<span class="number">0</span>)));</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="使用ElasticsearchRestTemplate"><a href="#使用ElasticsearchRestTemplate" class="headerlink" title="使用ElasticsearchRestTemplate"></a><strong>使用ElasticsearchRestTemplate</strong></h3><p>ElasticsearchRestTemplate模板类，封装了便捷操作Elasticsearch的模板方法，包括 索引 / 映射 / CRUD 等底层操作和高级操作。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">ElasticsearchRestTemplate elasticsearchRestTemplate;</span><br></pre></td></tr></tbody></table></figure>



<h4 id="索引操作"><a href="#索引操作" class="headerlink" title="索引操作"></a><strong>索引操作</strong></h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCreateIndex</span><span class="params">()</span>{</span><br><span class="line">    <span class="comment">//创建索引</span></span><br><span class="line">    <span class="type">IndexOperations</span> <span class="variable">indexOperations</span> <span class="operator">=</span> elasticsearchRestTemplate.indexOps(IndexCoordinates.of(<span class="string">"employee_index"</span>));</span><br><span class="line">    <span class="keyword">if</span> (indexOperations.exists()) {</span><br><span class="line">        log.info(<span class="string">"索引已经存在"</span>);</span><br><span class="line">    }<span class="keyword">else</span> {</span><br><span class="line">        <span class="comment">//创建索引</span></span><br><span class="line">        indexOperations.create();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteIndex</span><span class="params">()</span>{</span><br><span class="line">    <span class="comment">//删除索引</span></span><br><span class="line">    <span class="type">IndexOperations</span> <span class="variable">indexOperations</span> <span class="operator">=</span> elasticsearchRestTemplate.indexOps(IndexCoordinates.of(<span class="string">"employee_index"</span>));</span><br><span class="line">    indexOperations.delete();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h4 id="文档操作"><a href="#文档操作" class="headerlink" title="文档操作"></a><strong>文档操作</strong></h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testQueryDocument</span><span class="params">()</span>{</span><br><span class="line">    <span class="type">NativeSearchQueryBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NativeSearchQueryBuilder</span>();</span><br><span class="line">    <span class="comment">//查询</span></span><br><span class="line">    builder.withQuery(QueryBuilders.matchQuery(<span class="string">"address"</span>,<span class="string">"公园"</span>));</span><br><span class="line">    <span class="comment">// 设置分页信息</span></span><br><span class="line">    builder.withPageable(PageRequest.of(<span class="number">0</span>, <span class="number">5</span>));</span><br><span class="line">    <span class="comment">// 设置排序</span></span><br><span class="line">    builder.withSort(SortBuilders.fieldSort(<span class="string">"age"</span>).order(SortOrder.DESC));</span><br><span class="line"></span><br><span class="line">    SearchHits&lt;Employee&gt; search = elasticsearchRestTemplate.search(builder.build(), Employee.class);</span><br><span class="line">    List&lt;SearchHit&lt;Employee&gt;&gt; searchHits = search.getSearchHits();</span><br><span class="line">    <span class="keyword">for</span> (SearchHit hit: searchHits){</span><br><span class="line">        log.info(<span class="string">"返回结果："</span>+hit.toString());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsertBatch</span><span class="params">()</span>{</span><br><span class="line">    List&lt;Employee&gt; employees = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    employees.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">"2"</span>,<span class="string">"张三"</span>,<span class="number">1</span>,<span class="number">25</span>,<span class="string">"广州天河公园"</span>,<span class="string">"java developer"</span>));</span><br><span class="line">    employees.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">"3"</span>,<span class="string">"李四"</span>,<span class="number">1</span>,<span class="number">28</span>,<span class="string">"广州荔湾大厦"</span>,<span class="string">"java assistant"</span>));</span><br><span class="line">    employees.add(<span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">"4"</span>,<span class="string">"小红"</span>,<span class="number">0</span>,<span class="number">26</span>,<span class="string">"广州白云山公园"</span>,<span class="string">"php developer"</span>));</span><br><span class="line"></span><br><span class="line">    List&lt;IndexQuery&gt; queries = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (Employee employee : employees) {</span><br><span class="line">        <span class="type">IndexQuery</span> <span class="variable">indexQuery</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IndexQuery</span>();</span><br><span class="line">        indexQuery.setId(employee.getId());</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> JSONObject.toJSONString(employee);</span><br><span class="line">        indexQuery.setSource(json);</span><br><span class="line">        queries.add(indexQuery);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//bulk批量插入</span></span><br><span class="line">    elasticsearchRestTemplate.bulkIndex(queries,Employee.class);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Radish</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2024/06/11/ES(%E4%B8%80)-ElasticSearch%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%AE%9E%E6%88%98/">http://example.com/2024/06/11/ES(%E4%B8%80)-ElasticSearch%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%AE%9E%E6%88%98/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">萝卜的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ElasticSearch/">ElasticSearch</a></div><div class="post_share"><div class="social-share" data-image="/../img/git.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer=""></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2024/06/08/Git(%E4%BA%8C)-%E6%90%AD%E5%BB%BA%E4%BC%81%E4%B8%9A%E7%A7%81%E6%9C%89Git%E6%9C%8D%E5%8A%A1/" title="Git(二)-搭建企业私有Git服务"><img class="cover" src="/../img/git.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Git(二)-搭建企业私有Git服务</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/touxiang.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="author-info__name">Radish</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">72</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">19</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">愿内心深处的懦弱 不再将我吞噬</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2"><span class="toc-number">1.</span> <span class="toc-text">一、全文检索</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2"><span class="toc-number">1.1.</span> <span class="toc-text">1、什么是全文检索</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-number">1.2.</span> <span class="toc-text">2、全文检索的原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95"><span class="toc-number">1.3.</span> <span class="toc-text">3、什么是倒排索引</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81ElasticSearch%E7%AE%80%E4%BB%8B"><span class="toc-number">2.</span> <span class="toc-text">二、ElasticSearch简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81ElasticSearch%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.1.</span> <span class="toc-text">1、ElasticSearch介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81ElasticSearch"><span class="toc-number">2.2.</span> <span class="toc-text">2、ElasticSearch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B"><span class="toc-number">2.3.</span> <span class="toc-text">3、技术选型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81ElasticSearch%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">3.</span> <span class="toc-text">三、ElasticSearch环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%AE%89%E8%A3%85ElasticSearch%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">3.1.</span> <span class="toc-text">1、安装ElasticSearch环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#windows%E5%AE%89%E8%A3%85ElasticSearch"><span class="toc-number">3.1.1.</span> <span class="toc-text">windows安装ElasticSearch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#centos7%E5%AE%89%E8%A3%85ElasticSearch"><span class="toc-number">3.1.2.</span> <span class="toc-text">centos7安装ElasticSearch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E5%AE%89%E8%A3%85ElasticSearch"><span class="toc-number">3.1.3.</span> <span class="toc-text">Docker安装ElasticSearch</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%AE%A2%E6%88%B7%E7%AB%AFKibana%E5%AE%89%E8%A3%85"><span class="toc-number">3.2.</span> <span class="toc-text">2、客户端Kibana安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81ElasticSearch%E5%AE%89%E8%A3%85%E5%88%86%E8%AF%8D%E6%8F%92%E4%BB%B6"><span class="toc-number">3.3.</span> <span class="toc-text">3、ElasticSearch安装分词插件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E7%BA%BF%E5%AE%89%E8%A3%85analysis-icu%E5%88%86%E8%AF%8D%E6%8F%92%E4%BB%B6"><span class="toc-number">3.3.1.</span> <span class="toc-text">在线安装analysis-icu分词插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%BB%E7%BA%BF%E5%AE%89%E8%A3%85ik%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D%E6%8F%92%E4%BB%B6"><span class="toc-number">3.3.2.</span> <span class="toc-text">离线安装ik中文分词插件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81ElasticSearch%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B"><span class="toc-number">4.</span> <span class="toc-text">四、ElasticSearch快速开始</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81ElasticSearch%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">4.1.</span> <span class="toc-text">1、ElasticSearch核心概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8A%82%E7%82%B9%EF%BC%9ANode"><span class="toc-number">4.1.1.</span> <span class="toc-text">节点：Node</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%92%E8%89%B2%EF%BC%9ARoles"><span class="toc-number">4.1.2.</span> <span class="toc-text">角色：Roles</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%EF%BC%9AIndex"><span class="toc-number">4.1.3.</span> <span class="toc-text">索引：Index</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%EF%BC%9AType%EF%BC%88ES-7-x-%E4%B9%8B%E5%90%8E%E7%89%88%E6%9C%AC%E5%B7%B2%E5%88%A0%E9%99%A4%E6%AD%A4%E6%A6%82%E5%BF%B5%EF%BC%89"><span class="toc-number">4.1.4.</span> <span class="toc-text">类型：Type（ES 7.x 之后版本已删除此概念）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%EF%BC%9ADocument"><span class="toc-number">4.1.5.</span> <span class="toc-text">文档：Document</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81ElasticSearch%E7%B4%A2%E5%BC%95%E6%93%8D%E4%BD%9C"><span class="toc-number">4.2.</span> <span class="toc-text">2、ElasticSearch索引操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-number">4.2.1.</span> <span class="toc-text">创建索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E7%B4%A2%E5%BC%95"><span class="toc-number">4.2.2.</span> <span class="toc-text">查询索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="toc-number">4.2.3.</span> <span class="toc-text">删除索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE-Settings"><span class="toc-number">4.2.4.</span> <span class="toc-text">设置 Settings</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E7%B4%A2%E5%BC%95%E8%AE%BE%E7%BD%AE"><span class="toc-number">4.2.4.1.</span> <span class="toc-text">静态索引设置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E7%B4%A2%E5%BC%95%E8%AE%BE%E7%BD%AE"><span class="toc-number">4.2.4.2.</span> <span class="toc-text">动态索引设置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E6%96%87%E6%A1%A3%E6%98%A0%E5%B0%84Mapping"><span class="toc-number">4.2.5.</span> <span class="toc-text">设置文档映射Mapping</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E6%98%A0%E5%B0%84"><span class="toc-number">4.2.5.1.</span> <span class="toc-text">动态映射</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%98%A0%E5%B0%84"><span class="toc-number">4.2.5.2.</span> <span class="toc-text">静态映射</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8Mapping%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE"><span class="toc-number">4.2.5.3.</span> <span class="toc-text">常用Mapping参数配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8ReIndex%E9%87%8D%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-number">4.2.6.</span> <span class="toc-text">使用ReIndex重建索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81ElasticSearch%E6%96%87%E6%A1%A3%E6%93%8D%E4%BD%9C"><span class="toc-number">4.3.</span> <span class="toc-text">3、ElasticSearch文档操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E6%96%87%E6%A1%A3"><span class="toc-number">4.3.1.</span> <span class="toc-text">索引文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%96%87%E6%A1%A3"><span class="toc-number">4.3.2.</span> <span class="toc-text">查询文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#URI-Query%EF%BC%88%E4%BA%86%E8%A7%A3%E5%8D%B3%E5%8F%AF%EF%BC%89"><span class="toc-number">4.3.3.</span> <span class="toc-text">URI Query（了解即可）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DSL-Query"><span class="toc-number">4.3.4.</span> <span class="toc-text">DSL Query</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%96%87%E6%A1%A3"><span class="toc-number">4.3.5.</span> <span class="toc-text">修改文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%B6%E5%8F%91%E5%9C%BA%E6%99%AF%E4%B8%8B%E4%BF%AE%E6%94%B9%E6%96%87%E6%A1%A3"><span class="toc-number">4.3.6.</span> <span class="toc-text">并发场景下修改文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="toc-number">4.3.7.</span> <span class="toc-text">删除文档</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81ElasticSearch%E6%96%87%E6%A1%A3%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C"><span class="toc-number">4.4.</span> <span class="toc-text">4、ElasticSearch文档批量操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E5%86%99%E5%85%A5"><span class="toc-number">4.4.1.</span> <span class="toc-text">批量写入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E5%88%9B%E5%BB%BA%E6%96%87%E6%A1%A3create"><span class="toc-number">4.4.2.</span> <span class="toc-text">批量创建文档create</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E5%88%9B%E5%BB%BA%E6%88%96%E5%85%A8%E9%87%8F%E6%9B%BF%E6%8D%A2index"><span class="toc-number">4.4.3.</span> <span class="toc-text">普通创建或全量替换index</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4delete"><span class="toc-number">4.4.4.</span> <span class="toc-text">批量删除delete</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E4%BF%AE%E6%94%B9update"><span class="toc-number">4.4.5.</span> <span class="toc-text">批量修改update</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E5%BA%94%E7%94%A8"><span class="toc-number">4.4.6.</span> <span class="toc-text">组合应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E8%AF%BB%E5%8F%96"><span class="toc-number">4.4.7.</span> <span class="toc-text">批量读取</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81Spring-Boot%E6%95%B4%E5%90%88ElasticSearch%E5%AE%9E%E6%88%98"><span class="toc-number">4.5.</span> <span class="toc-text">5、Spring Boot整合ElasticSearch实战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0ElasticsearchRepository"><span class="toc-number">4.5.1.</span> <span class="toc-text">实现ElasticsearchRepository</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8ElasticsearchRestTemplate"><span class="toc-number">4.5.2.</span> <span class="toc-text">使用ElasticsearchRestTemplate</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E6%93%8D%E4%BD%9C"><span class="toc-number">4.5.2.1.</span> <span class="toc-text">索引操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E6%93%8D%E4%BD%9C"><span class="toc-number">4.5.2.2.</span> <span class="toc-text">文档操作</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/06/11/ES(%E4%B8%80)-ElasticSearch%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%AE%9E%E6%88%98/" title="无题"><img src="/../img/git.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"></a><div class="content"><a class="title" href="/2024/06/11/ES(%E4%B8%80)-ElasticSearch%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8%E5%AE%9E%E6%88%98/" title="无题">无题</a><time datetime="2024-06-11T15:06:00.000Z" title="发表于 2024-06-11 23:06:00">2024-06-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/06/08/Git(%E4%BA%8C)-%E6%90%AD%E5%BB%BA%E4%BC%81%E4%B8%9A%E7%A7%81%E6%9C%89Git%E6%9C%8D%E5%8A%A1/" title="Git(二)-搭建企业私有Git服务"><img src="/../img/git.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Git(二)-搭建企业私有Git服务"></a><div class="content"><a class="title" href="/2024/06/08/Git(%E4%BA%8C)-%E6%90%AD%E5%BB%BA%E4%BC%81%E4%B8%9A%E7%A7%81%E6%9C%89Git%E6%9C%8D%E5%8A%A1/" title="Git(二)-搭建企业私有Git服务">Git(二)-搭建企业私有Git服务</a><time datetime="2024-06-08T04:38:00.000Z" title="发表于 2024-06-08 12:38:00">2024-06-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/30/Zookeeper(%E4%BA%8C)-ZK%E7%BB%8F%E5%85%B8%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E5%AE%9E%E8%B7%B5/" title="Zookeeper(二)-ZK经典应用场景实践"><img src="/../img/zk_logo.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Zookeeper(二)-ZK经典应用场景实践"></a><div class="content"><a class="title" href="/2024/05/30/Zookeeper(%E4%BA%8C)-ZK%E7%BB%8F%E5%85%B8%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E5%AE%9E%E8%B7%B5/" title="Zookeeper(二)-ZK经典应用场景实践">Zookeeper(二)-ZK经典应用场景实践</a><time datetime="2024-05-30T15:21:00.000Z" title="发表于 2024-05-30 23:21:00">2024-05-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/27/Git(%E4%B8%80)-Git%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E4%B8%8E%E6%A0%B8%E5%BF%83%E5%91%BD%E4%BB%A4/" title="Git(一)-Git基本概念与核心命令"><img src="/../img/git.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Git(一)-Git基本概念与核心命令"></a><div class="content"><a class="title" href="/2024/05/27/Git(%E4%B8%80)-Git%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5%E4%B8%8E%E6%A0%B8%E5%BF%83%E5%91%BD%E4%BB%A4/" title="Git(一)-Git基本概念与核心命令">Git(一)-Git基本概念与核心命令</a><time datetime="2024-05-27T13:52:00.000Z" title="发表于 2024-05-27 21:52:00">2024-05-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/27/Zookeeper(%E4%B8%80)-ZK%E7%89%B9%E6%80%A7%E4%B8%8E%E8%8A%82%E7%82%B9%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E8%AF%A6%E8%A7%A3/" title="Zookeeper(一)-ZK特性与节点数据类型详解"><img src="/../img/zk_logo.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Zookeeper(一)-ZK特性与节点数据类型详解"></a><div class="content"><a class="title" href="/2024/05/27/Zookeeper(%E4%B8%80)-ZK%E7%89%B9%E6%80%A7%E4%B8%8E%E8%8A%82%E7%82%B9%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E8%AF%A6%E8%A7%A3/" title="Zookeeper(一)-ZK特性与节点数据类型详解">Zookeeper(一)-ZK特性与节点数据类型详解</a><time datetime="2024-05-27T13:52:00.000Z" title="发表于 2024-05-27 21:52:00">2024-05-27</time></div></div></div></div></div></div></main><footer id="footer" style="background: transparent"><div id="footer-wrap"><div class="copyright">©2023 - 2024 By Radish</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>